

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Collector &mdash; pyeuv 1.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Do_It" href="Do_It.html" />
    <link rel="prev" title="Parsers" href="Parsers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pyeuv
          

          
            
            <img src="_static/ASML_Logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About pyeuv</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="qa.html">Q&amp;A</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_testing.html">Unit testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="EUVDashboard.html">EUVDashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="PMA.html">PMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="RT_Processing.html">RT_Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parsers.html">Parsers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#slie-dt">SLIE/DT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-pyeuv.Collector.Sliedt.incident_detection">Incident detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#radon">Radon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#readme-for-static-data-files">readme for static data files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-pyeuv.Collector.Radon.radd">Radd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-pyeuv.Collector.Sliedt.illuminator_degradation">Illuminator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-pyeuv.Collector.Shared.directory_structure">Shared</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Do_It.html">Do_It</a></li>
<li class="toctree-l2"><a class="reference internal" href="TinManagement.html">TinManagement</a></li>
<li class="toctree-l2"><a class="reference internal" href="Shared.html">Shared</a></li>
<li class="toctree-l2"><a class="reference internal" href="helpers.html">helpers</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyeuv</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="api_reference.html">API Reference</a> &raquo;</li>
        
      <li>Collector</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Collector.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="collector">
<h1>Collector<a class="headerlink" href="#collector" title="Permalink to this headline">¶</a></h1>
<div class="section" id="slie-dt">
<h2>SLIE/DT<a class="headerlink" href="#slie-dt" title="Permalink to this headline">¶</a></h2>
<p><em>Diagrams</em></p>
<img alt="_images/radon_task_dependency.png" src="_images/radon_task_dependency.png" />
<p><em>Function reference</em></p>
<span class="target" id="module-pyeuv.Collector.Sliedt.sliedt"></span><p>sliedt.py
Authors: RWKL
Date:  2018-09-21</p>
<p>Ownership: SF-18 (FC-079, FC-086)</p>
<p>Code is based on SLIE/DT from Grafana
SLIE/DT calculation including filters and corrections that can optionally be turned on and off</p>
<p>Change history:
Date       | Author | Feature
———–+——–+————————————————————————————————
2020-09-07 | DANT   | bugfix/SSPT-599-fix-bug-in-filter_dose_target_at_slie-function</p>
<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.add_pulse_count_to_data">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">add_pulse_count_to_data</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">pulse_count</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#add_pulse_count_to_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.add_pulse_count_to_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Short function merging pulse count data into another dataframe.
The pulse count data is linearly interpolated in time domain to the</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – the dataframe we are working with</p></li>
<li><p><strong>pulse_count</strong> – dataframe containing pulse_count data
(multiple columns allowed (collector and cummulative pulse_count))</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dataframe containing the original data and the pulse count columns merged into it</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_artifact_correction">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_artifact_correction</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">key</em>, <em class="sig-param">artifact_corrections</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_artifact_correction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_artifact_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>the slie data is corrected for artificial jumps, such as
- insertion of a membrane (or replacement)
- g-mirror swap
- other upgrades / changes in the optical path</p>
<p>To correct for the artifact, the slie has to be multiplied by a factor
slie_artifact_corrections contains a time series of corrections, which are the valid
factors from the timestamp of the entry until the next entry or end of collector</p>
<p>Another possibility is to correct the SLIE/DT ratio by multiplying it with a factor
sliedt_artefact. It also contains a time series of corrections.</p>
<p>TODO: replace this by a signal that contains the correction factor and description
Example:
Replacing a membrane of type 3 to type 4 should be 2 entries:
- removal: factor = 1/0.88 (assuming a spec of 12% loss by the membrane type 3)
- insertion: factor = 0.9 (assuming a spec of 10% loss by the membrane type 4)
The effective correction at time t should be the product of all corrections before t
The description could be used to annotate graphs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing slie as first (and only) column</p></li>
<li><p><strong>key</strong> – column name in the data to be used in this function</p></li>
<li><p><strong>artifact_corrections</strong> – dataframe containing start times for correction factors to be applied</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>returns the dataframe with the corrected value for slie</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_ecal_ratio_correction">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_ecal_ratio_correction</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">slie_key</em>, <em class="sig-param">ecal</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_ecal_ratio_correction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_ecal_ratio_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>The slie data is corrected for the ecal measurement.
Ecal refresh is only actuated when the deviation is &gt;1%. The deviation is
represented in ecal_sensor_factor_ratio. After the ecal refresh, the ratio
is back to a value close to 1, after which it will start to deviate, until the next
ecal refresh will take place.</p>
<p>The first ecal sensor factor ratio data point after the refresh is untrustworthy,
and should in theory be 1. This is corrected in the data, before being applied to slie</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – slie dataframe</p></li>
<li><p><strong>slie_key</strong> – the column name within dataframe refering to the slie data</p></li>
<li><p><strong>ecal</strong> – ecal dataframe, containing columns for ecal_sensor_factor and ecal_sensor_factor_ratio</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with column dw_slie</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_filter">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_filter</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">fltr</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters data based on the provided filter.
The filter is merged into data, and forward filled since the timestamps of
the data and filter do not coincide.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing one column with the filter to be applied</p></li>
<li><p><strong>fltr</strong> – timebased filter to be applied</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe after filtering out using the provided filter</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_illumination_mode_correction">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_illumination_mode_correction</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">key</em>, <em class="sig-param">illumination_modes</em>, <em class="sig-param">correction_factors</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_illumination_mode_correction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_illumination_mode_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply corrections for efficiency of different illumination modes.
This correction is only performed when the illumination mode is provided and known.
Otherwise, the slie data will be ignored</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing slie</p></li>
<li><p><strong>key</strong> – column name of slie data</p></li>
<li><p><strong>illumination_modes</strong> – dataframe containing illumination mode information</p></li>
<li><p><strong>correction_factors</strong> – dictionary containing correction factors for standard illumination modes</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing corrected slie dataand the illumination mode for known illumination modes only</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_normalization">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_normalization</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">key</em>, <em class="sig-param">factor</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_normalization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_normalization" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalizes slie_dt and adds it as a new column to the original dataframe</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing slie_dt</p></li>
<li><p><strong>key</strong> – column name in the data to be used in this function</p></li>
<li><p><strong>factor</strong> – normalization factor</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the dataframe including an additional column with the normalized SLIE/DT</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_pf_degradation_correction">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_pf_degradation_correction</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">slie_key</em>, <em class="sig-param">pf_transmission</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_pf_degradation_correction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_pf_degradation_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>Corrects slie for pupil facet degradation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing slie</p></li>
<li><p><strong>slie_key</strong> – column name of the slie data</p></li>
<li><p><strong>pf_transmission</strong> – dataframe containing transmission (1 - loss) per illumination mode over time</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with slie corrected for illumination mode degradation and column
containing the relative transmission per illumination mode</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_rolling_median_filter">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_rolling_median_filter</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">ratio=0.05</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_rolling_median_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_rolling_median_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies a rolling median filter to the slie_dt,
The filter is applies on all the data points of slie_dt deviates for which
the data point deviates more than ratio from the rolling median.
First a copy of the slie_dt_norm values are stored as slie_dt_no_filter
Then, the filter is applied by setting the filtered values to NaN.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing the normalized slie/dt and rolling median</p></li>
<li><p><strong>ratio</strong> – maximum relative deviation considered ok. Data set to np.NaN for larger deviation (default=0.05)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with an additional column for the slie_dt before filtering</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_threshold_filter">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_threshold_filter</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">key</em>, <em class="sig-param">lower_threshold=-inf</em>, <em class="sig-param">upper_threshold=-inf</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_threshold_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_threshold_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to apply a simple threshold filter</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe to be filtered</p></li>
<li><p><strong>key</strong> – key in data to be used to apply the filter</p></li>
<li><p><strong>lower_threshold</strong> – lower threshold (default=-inf)</p></li>
<li><p><strong>upper_threshold</strong> – upper threshold (default=inf)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dataframe after filtering</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.apply_uniformity_refresh_filter">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">apply_uniformity_refresh_filter</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#apply_uniformity_refresh_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.apply_uniformity_refresh_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Uniformity Refresh filtering
SLIE measurements are performed in pairs.
The first is with the LULU calibrated finger positions, so more honest SLIE measurement
The second is with the fingers positions such that uniformity is improved, blocking some light
The first of the 2 successive measurements is used</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing a time series of slie data</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>slie measurements with LULU calibrated finger positions</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas dataframe</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.build_valid_measurement_filter">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">build_valid_measurement_filter</code><span class="sig-paren">(</span><em class="sig-param">filter_signals</em>, <em class="sig-param">sv_gate</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#build_valid_measurement_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.build_valid_measurement_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to build filter. It combines several filter signals and uses the default values in case
filter data is unavailable</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter_signals</strong> – signals from the filter signal group</p></li>
<li><p><strong>sv_gate</strong> – scanner gate signal (1 means open)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>dataframe</p>
</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dataframe</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with True/False filter signal</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.calculate_degradation_rate">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">calculate_degradation_rate</code><span class="sig-paren">(</span><em class="sig-param">df, key, windows=[1.0, 3.0, 5.0, 20.0], post_fix='', previous_only=True, advanced_analysis=False, verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#calculate_degradation_rate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.calculate_degradation_rate" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the overall degradation rate as well as the rate and confidence interval for different pulse count
windows of a given signal. A window of x has at least a range of x pulsecounts, so the data point in that window
is at least x (max - min &gt;= x)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – input dataframe containing a column ‘pulse_count’ (in Gp) and key</p></li>
<li><p><strong>key</strong> – key of the signal for which the rate is calculated</p></li>
<li><p><strong>windows</strong> – list of pulse count windows (in Gp) to be calculated (default: [1.0, 3.0, 5.0, 20.0])</p></li>
<li><p><strong>post_fix</strong> – in case one needs to add a postfix to the created degradation rate signals, for instance ‘_nonSG’,
one can use this post_fix (default: ‘’)</p></li>
<li><p><strong>previous_only</strong> – when true calculates only the previous x Gp window (default) and skips the
centered x Gp window (less relevant for Grafana dashboards). False calculates both.</p></li>
<li><p><strong>advanced_analysis</strong> – when true calculate linear fit including the confidence interval and adjusted R squared.
Otherwise only the linear fit slope (faster calculation)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing the original signals and degradation rates.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.calculate_rolling_median">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">calculate_rolling_median</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">window=31</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#calculate_rolling_median"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.calculate_rolling_median" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a column with the rolling median of slie_dt</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing slie_dt</p></li>
<li><p><strong>window</strong> – number of datapoints used for the rolling median, typically an odd number (default=31)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with an additional column for the rolling median of the slie/dt</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.calculate_sg_filter">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">calculate_sg_filter</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">window=31</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#calculate_sg_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.calculate_sg_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies the Savitsky Golay filter on slie_dt_norm and stores it as slie_dt_norm_sg</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing the normalized slie/dt</p></li>
<li><p><strong>window</strong> – number of datapoints used for the Savitsky Golay filter,
typically an odd number (default=31)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with the additional column slie_dt_sg_norm</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.calculate_slie_dt">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">calculate_slie_dt</code><span class="sig-paren">(</span><em class="sig-param">slie_data</em>, <em class="sig-param">use_ecal_ratio_correction=True</em>, <em class="sig-param">use_pf_degradation_correction=False</em>, <em class="sig-param">use_dt_of_slie_measurement=True</em>, <em class="sig-param">threshold_slie_lower=100.0</em>, <em class="sig-param">threshold_slie_upper=23000.0</em>, <em class="sig-param">threshold_sliedt_lower=10.0</em>, <em class="sig-param">threshold_sliedt_upper=500.0</em>, <em class="sig-param">threshold_dose_lower=5.0</em>, <em class="sig-param">threshold_dose_upper=100.0</em>, <em class="sig-param">window_normalization=5.0</em>, <em class="sig-param">window_sg=31</em>, <em class="sig-param">window_median=31</em>, <em class="sig-param">margin_median_filter=0.05</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#calculate_slie_dt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.calculate_slie_dt" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to calculate slie_dt and supporting signals (normalized signals, illumination mode, etc),
based on a dictionary of dataframes (dataframe per signal group)
It includes:</p>
<ul class="simple">
<li><p>filtering: lot filter, uniformity refresh, threshold,</p></li>
<li><p>corrections: illumination mode, artefacts, ecal_ratio</p></li>
<li><p>determining the collector pulse count (should it be extracted? required for normalization)</p></li>
<li><p>normalized slie/dt calculation</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>slie_data</strong> – <p>dictionary containing dataframes of data per signal group. Expected groups and signals are:</p>
<p><strong>collector</strong></p>
<ul>
<li><p>Collector._NormalizationCorrection</p></li>
</ul>
<p><strong>dose</strong></p>
<ul>
<li><p>RT05.BDenergyTargetAvg</p></li>
</ul>
<p><strong>ecal</strong></p>
<ul>
<li><p>RT12.ECALextSensorFactor,</p></li>
<li><p>RT12.ECALextSensorFactorRatio,</p></li>
</ul>
<p><strong>filter</strong></p>
<ul>
<li><p>Filter._LotSignal,</p></li>
<li><p>Filter._ManualBlockCollector,</p></li>
</ul>
<p><strong>pf_transmission</strong></p>
<ul>
<li><p>dataframe with transmission per known illumination mode</p></li>
</ul>
<p><strong>scanner</strong></p>
<ul>
<li><p>Scanner.DW_SLIE,</p></li>
<li><p>Scanner.DW_total_nr_pulses,</p></li>
<li><p>Scanner.DW_SLIE_FSLIE_PS_doe_id,</p></li>
<li><p>Scanner.DW_SLIE_FSLIE_PS_sigma_inner,</p></li>
<li><p>Scanner.DW_SLIE_FSLIE_PS_sigma_outer,</p></li>
<li><p>Scanner.DW_SV_state</p></li>
</ul>
</p></li>
<li><p><strong>use_ecal_ratio_correction</strong> – switch for the correction to SLIE using ECALextSensorFactorRatio (default=True)</p></li>
<li><p><strong>use_pf_degradation_correction</strong> – switch for the correction of pf degradation,
using a model assuming exponential decay as function of usage (default=True)</p></li>
<li><p><strong>use_dt_of_slie_measurement</strong> – method to select the DT used for the SLIE measurement (default: False),</p></li>
<li><p><strong>threshold_slie_lower</strong> – lower threshold for slie (default=100.0)</p></li>
<li><p><strong>threshold_slie_upper</strong> – upper threshold for slie (default=15000.0)</p></li>
<li><p><strong>threshold_sliedt_lower</strong> – lower threshold for sliedt (default=10.0)</p></li>
<li><p><strong>threshold_sliedt_upper</strong> – upper threshold for sliedt (default=500.0)</p></li>
<li><p><strong>threshold_dose_lower</strong> – lower threshold for dose (default= 5.0)</p></li>
<li><p><strong>threshold_dose_upper</strong> – upper threshold for slie (default=100.0)</p></li>
<li><p><strong>window_normalization</strong> – Gp window at the start of the collector (counting from the first data point)
to be used for normalization (default=5.0)</p></li>
<li><p><strong>window_sg</strong> – window used for the sg filter of slie/dt (default=31, advise: odd number)</p></li>
<li><p><strong>window_median</strong> – window used for the rolling median of slie/dt (default=31, advise: odd number)</p></li>
<li><p><strong>margin_median_filter</strong> – margin (relative ratio) used to build the rolling median filter (default=0.05)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with slie_dt and supporting signals</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.filter_dose_target_at_slie">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">filter_dose_target_at_slie</code><span class="sig-paren">(</span><em class="sig-param">dt</em>, <em class="sig-param">data</em>, <em class="sig-param">use_dt_of_slie_measurement=True</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#filter_dose_target_at_slie"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.filter_dose_target_at_slie" title="Permalink to this definition">¶</a></dt>
<dd><p>This function filters the dose target (RT05) signal at the time of when SLIE was measured but with a max time offset
of 1 second into the future (to prevent a not relevant point is selected)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dt</strong> – dataframe containing dose target data</p></li>
<li><p><strong>data</strong> – dataframe containing dw_slie data</p></li>
<li><p><strong>use_dt_of_slie_measurement</strong> – method to select the DT used for the SLIE measurement (default: True),</p></li>
<li><p><strong>verbose</strong> – to switch internal debugging info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing dose target at slie measurement time</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.get_collector_pulse_count">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">get_collector_pulse_count</code><span class="sig-paren">(</span><em class="sig-param">pulse_count_cumm</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#get_collector_pulse_count"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.get_collector_pulse_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to determine the collector pulse count, based on the collector pulsecount
It assumes the cummulative pulse count from the start of the collector</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pulse_count_cumm</strong> – dataframe containing the cummulative pulse count in Mp from the start of a collector onwards</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing the cummulative pulse count and collector pulse count in Gp</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.get_normalization_factor">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">get_normalization_factor</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">window=5.0</em>, <em class="sig-param">quantile=0.99</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#get_normalization_factor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.get_normalization_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the normalization factor requered to normalize SLIE/DT to 100%
The normalization is based on the 99th (optional parameter) percentile within a window
in the Gp domain at the start of the data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dataframe containing slie_dt and pulse_count</p></li>
<li><p><strong>window</strong> – window in Gp at start of the data used to determine the normalization factor (default: 5.0)</p></li>
<li><p><strong>quantile</strong> – the quantile to be used on the data to determine the maximum.
This quantile is used to normalize on the bulk, instead of a single outlier</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the normalization factor for SLIE/DT</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.sliedt.get_slie_dt">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.sliedt.</code><code class="sig-name descname">get_slie_dt</code><span class="sig-paren">(</span><em class="sig-param">slie</em>, <em class="sig-param">dt</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/sliedt.html#get_slie_dt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.sliedt.get_slie_dt" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that calculates slie/dt by merging dataframes of slie and dose target.
The forward filling of the dose target is limited to 1 row
to avoid incorrect dose target values used in case of missing data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>slie</strong> – dataframe containing slie data</p></li>
<li><p><strong>dt</strong> – dataframe containing dose target data</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing slie and slie/dt data</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-pyeuv.Collector.Sliedt.incident_detection">
<span id="incident-detection"></span><h2>Incident detection<a class="headerlink" href="#module-pyeuv.Collector.Sliedt.incident_detection" title="Permalink to this headline">¶</a></h2>
<p>Created on Thu Oct 18 10:38:37 2018</p>
<p>&#64;author: rwiegger</p>
<p>A library containing collector incident detection algorithms.
It includes:
- Collector Degradation Limiter (CDL)</p>
<dl class="function">
<dt id="pyeuv.Collector.Sliedt.incident_detection.calculate_cdl">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.incident_detection.</code><code class="sig-name descname">calculate_cdl</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">threshold_loss=5.0</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/incident_detection.html#calculate_cdl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.incident_detection.calculate_cdl" title="Permalink to this definition">¶</a></dt>
<dd><p>Collector Degradation Limiter (CDL) Algo by TBAV
The CDL is the signal how many Gp ago SLIE/DT was threshold_loss higher.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pandas.DataFrame</em>) – Series with pulse count (in Gp) and SLIE/DT</p></li>
<li><p><strong>threshold_loss</strong> (<em>float</em>) – threshold for reflectivity loss</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.incident_detection.calculate_cdl_triggers">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.incident_detection.</code><code class="sig-name descname">calculate_cdl_triggers</code><span class="sig-paren">(</span><em class="sig-param">cdl_window</em>, <em class="sig-param">threshold_pulse_count=1.0</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/incident_detection.html#calculate_cdl_triggers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.incident_detection.calculate_cdl_triggers" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the CDL triggers, and adds useful data
(start, end, delta for timestamp (unix), gp, reflectivity)
The CDL is triggered when within ‘threshold_pulse_count’ ‘threshold_loss’ is lossed.
- The start of the event is the last data point the reflectivity was ‘threshold_loss’ higher than the moment of the trigger.
- The event extends in the future to the minimum reflectivity within the window where the CDL continues to be triggered.
So successive datapoints for which the CDL would be triggered will not
result in multiple CDL events. These triggers get merged to 1 event.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>threshold_pulse_count</strong> (<em>float</em>) – threshold for maximum pulse ccount range</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.incident_detection.get_cdl_signal_names">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.incident_detection.</code><code class="sig-name descname">get_cdl_signal_names</code><span class="sig-paren">(</span><em class="sig-param">sg_filter=True</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/incident_detection.html#get_cdl_signal_names"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.incident_detection.get_cdl_signal_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that returns a dictionary with required signals to calculate the CDL</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sg_filter</strong> – cwitch for the SG filtered slie/dt (SG filter used by default)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary containing keys used as column names in the dataframes, and influx signal names as value.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.incident_detection.get_data">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.incident_detection.</code><code class="sig-name descname">get_data</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">from_time</em>, <em class="sig-param">to_time</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/incident_detection.html#get_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.incident_detection.get_data" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain all the required data from influx</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>source_id</strong> – the source_id for which the signals have to be retrieved</p></li>
<li><p><strong>from_time</strong> – start time of the window of data to be retrieved</p></li>
<li><p><strong>to_time</strong> – start time of the window of data to be retrieved</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with dataframes per signal group</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.incident_detection.get_start_of_cdl">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.incident_detection.</code><code class="sig-name descname">get_start_of_cdl</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">data</em>, <em class="sig-param">threshold_loss</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/incident_detection.html#get_start_of_cdl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.incident_detection.get_start_of_cdl" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets start of a fast degradation event</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – </p></li>
<li><p><strong>data</strong> – </p></li>
<li><p><strong>threshold_loss</strong> – </p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.incident_detection.prep_data">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.incident_detection.</code><code class="sig-name descname">prep_data</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/incident_detection.html#prep_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.incident_detection.prep_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare the cdl data before usage.
- Interpolate pulse count to reflectivity datapoints
- convert pulse count to Gp
- remove NaN</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – connection to influx</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>pandas dataframe</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>series of timestamp, pulse_count and</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="radon">
<h2>Radon<a class="headerlink" href="#radon" title="Permalink to this headline">¶</a></h2>
<p><em>Functional diagrams</em></p>
<img alt="_images/radon_task_dependency.png" src="_images/radon_task_dependency.png" />
<img alt="_images/functional_tasks_for_radon_tooling.png" src="_images/functional_tasks_for_radon_tooling.png" />
<ul class="simple">
<li><p>Function reference *</p></li>
</ul>
<span class="target" id="module-pyeuv.Collector.Radon.radon_roi"></span><p>radon_roi.py
Authors: RWKL
Date:  2019-05-12</p>
<p>Radon ROI calculated the contribution within a region of interest, as part of the total loss within a radon image.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyeuv.EUVDashboard.clients</span> <span class="kn">import</span> <span class="n">UserLANClient</span>
<span class="kn">from</span> <span class="nn">pyeuv.Collector.Radon.radon_roi</span> <span class="kn">import</span> <span class="n">get_predefined_rois</span>
<span class="kn">from</span> <span class="nn">pyeuv.Collector.Radon.radon_roi</span> <span class="kn">import</span> <span class="n">radon_io</span>
<span class="kn">from</span> <span class="nn">pyeuv.Collector.Radon.radon_roi</span> <span class="kn">import</span> <span class="n">calculate_roi_contributions</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">UserLANClient</span><span class="p">()</span>
<span class="n">raw_luer_file</span> <span class="o">=</span> <span class="s1">&#39;LUER_mYYYY_timestamp.XXXX.raw&#39;</span>
<span class="n">processed_luer_file</span> <span class="o">=</span> <span class="s1">&#39;LUER.XXXX._SN_FAR_FIELD_WITH_DOTS.dat&#39;</span>
<span class="n">processed_luer</span> <span class="o">=</span> <span class="n">radon_io</span><span class="o">.</span><span class="n">load_dots</span><span class="p">(</span><span class="n">processed_luer_file</span><span class="p">)</span>
<span class="n">luer_dict</span> <span class="o">=</span> <span class="n">radon_io</span><span class="o">.</span><span class="n">get_luer_dict_object</span><span class="p">(</span><span class="n">processed_luer</span><span class="p">,</span> <span class="n">raw_luer_file</span><span class="p">)</span>
<span class="n">loss_per_roi</span> <span class="o">=</span> <span class="n">calculate_roi_contributions</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">luer_dict</span><span class="p">,</span> <span class="n">roi_dict</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>New functions (DAAU): scale_generic_ref, calculate_stains, generate_analysis_results,</dt><dd><p>calculate_initial_reflectivity_loss, add_local_reflectivity</p>
</dd>
</dl>
<p>Date:  2020-06-02</p>
<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.add_local_reflectivity">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">add_local_reflectivity</code><span class="sig-paren">(</span><em class="sig-param">luer</em>, <em class="sig-param">reference</em>, <em class="sig-param">verbose</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#add_local_reflectivity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.add_local_reflectivity" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the local reflectivity per data point to the luer dataframe</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer</strong> – dictionary with luer data</p></li>
<li><p><strong>reference</strong> – dictionary with reference luer data</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with luer data including local reflectivity</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.add_reflectivity_loss">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">add_reflectivity_loss</code><span class="sig-paren">(</span><em class="sig-param">luer</em>, <em class="sig-param">reference</em>, <em class="sig-param">verbose</em>, <em class="sig-param">mask=None</em>, <em class="sig-param">mask_prefix=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#add_reflectivity_loss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.add_reflectivity_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the reflectivity loss contribution per data point to the luer dataframe
The sum of all these loss contributions sum up to the total loss (as percentage)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer</strong> – dictionary with luer data</p></li>
<li><p><strong>reference</strong> – dictionary with reference luer data</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
<li><p><strong>mask</strong> – apply on to limited area of luer data</p></li>
<li><p><strong>mask</strong> – add mask_prefix to not confuse with non-masked column name</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with luer data including reflectivity loss</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.calculate_initial_reflectivity_loss">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">calculate_initial_reflectivity_loss</code><span class="sig-paren">(</span><em class="sig-param">luer</em>, <em class="sig-param">reference</em>, <em class="sig-param">calibration_factor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#calculate_initial_reflectivity_loss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.calculate_initial_reflectivity_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>This function calculates the initial reflectivity loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer</strong> – dictionary containing luers to process, scaling factors, etc.</p></li>
<li><p><strong>reference</strong> – dictionary with reference luer data</p></li>
<li><p><strong>calibration_factor</strong> – the calibration factor for the reference intensity</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe:
initial_reflectivity_loss: the estimation of the initial relative reflectivity loss</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.calculate_roi_contributions">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">calculate_roi_contributions</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">luer_dict</em>, <em class="sig-param">roi_dict</em>, <em class="sig-param">reference_type='new_collectors_per_mirror_and_pupil'</em>, <em class="sig-param">scaling_method='sliedt_interpolate'</em>, <em class="sig-param">ref_scaling_method=None</em>, <em class="sig-param">threshold_slie_dt_upper=110</em>, <em class="sig-param">use_sg_filtering=False</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">verbose=False</em>, <em class="sig-param">analyze_stains=False</em>, <em class="sig-param">conf=None</em>, <em class="sig-param">custom_dir=None</em>, <em class="sig-param">use_first_stain_area=False</em>, <em class="sig-param">icrm=False</em>, <em class="sig-param">compensate_shift=False</em>, <em class="sig-param">min_bound_correction=False</em>, <em class="sig-param">custom_reference_filepath=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#calculate_roi_contributions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.calculate_roi_contributions" title="Permalink to this definition">¶</a></dt>
<dd><p>This function calculates calculates the contribution per ROI.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>source_id</strong> – source id of system for which we are calculating the ROI contributions</p></li>
<li><p><strong>luer_dict</strong> – dictionary containing luers to process, scaling factors, etc.</p></li>
<li><p><strong>roi_dict</strong> – dictionary with roi definitions. The dictionary contains one roi per luer_key.
Each roi contains ‘type’ (polygon, polar_bounds) and a set of keys depending on the type.</p></li>
<li><p><strong>reference_type</strong> – string to specify what type of reference image has to be used.</p></li>
<li><p><strong>scaling_method</strong> – string to specify which scaling method to be applied. Options are ‘sliedt_interpolate’
(default), ‘sliedt_nearest’, ‘sliedt_ffill’, ‘intensity’</p></li>
<li><p><strong>ref_scaling_method</strong> – method to scale the reference to the right global reflectivity value</p></li>
<li><p><strong>threshold_slie_dt_upper</strong> – upper limit fir slie_dt</p></li>
<li><p><strong>use_sg_filtering</strong> – apply sg filter for slie/dt scaling of luers (default: False)</p></li>
<li><p><strong>use_keys</strong> – switch to use with_keys format for with_dots luer files</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
<li><p><strong>analyze_stains</strong> – provide extensive extra info + plots on the generic reference scale in the results file</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>custom_dir</strong> – custom directory to store images/analysis results</p></li>
<li><p><strong>use_first_stain_area</strong> – only use the stains detected in the first luer for processing the other luers</p></li>
<li><p><strong>icrm</strong> – use icrm data instead of SLIE/DT</p></li>
<li><p><strong>compensate_shift</strong> – compensate the shift of the non-stain peak, and use this to estimate the scanner loss</p></li>
<li><p><strong>min_bound_correction</strong> – use a specific width of a histogram (e.g. from the first LUER) to correct the min-bound
for stain detection</p></li>
<li><p><strong>custom_reference_filepath</strong> – select a custom reference path</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with loss per roi. The key should be the luer timestamp.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.calculate_stains">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">calculate_stains</code><span class="sig-paren">(</span><em class="sig-param">loss_per_roi</em>, <em class="sig-param">luer_key</em>, <em class="sig-param">luer</em>, <em class="sig-param">reference</em>, <em class="sig-param">roi_dict</em>, <em class="sig-param">mask_dict</em>, <em class="sig-param">ref_scaling_method</em>, <em class="sig-param">conf</em>, <em class="sig-param">custom_dir</em>, <em class="sig-param">use_first_stain_area</em>, <em class="sig-param">first_key</em>, <em class="sig-param">verbose</em>, <em class="sig-param">min_bound_correction=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#calculate_stains"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.calculate_stains" title="Permalink to this definition">¶</a></dt>
<dd><p>Analyzes the ROI in more detail by looking at the stain vs non-stain region</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss_per_roi</strong> – dataframe with the end results on reflectivity</p></li>
<li><p><strong>luer_key</strong> – luer id</p></li>
<li><p><strong>luer</strong> – luer information including intensity, reflectivity</p></li>
<li><p><strong>reference</strong> – reference information including intensity, reflectivity</p></li>
<li><p><strong>roi_dict</strong> – dictionary with roi definitions. The dictionary contains one roi per luer_key.
Each roi contains ‘type’ (polygon, polar_bounds) and a set of keys depending on the type.</p></li>
<li><p><strong>mask_dict</strong> – dictionary of custom rois.</p></li>
<li><p><strong>ref_scaling_method</strong> – refernece scaling method</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>custom_dir</strong> – custom directory to store images/analysis results</p></li>
<li><p><strong>use_first_stain_area</strong> – fixate the stain vs non-stain region using the first luer</p></li>
<li><p><strong>first_key</strong> – the luer id of the first luer</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>loss_per_roi: dataframe with the end results on reflectivity per ler</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.deal_with_dark_facets">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">deal_with_dark_facets</code><span class="sig-paren">(</span><em class="sig-param">luer</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#deal_with_dark_facets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.deal_with_dark_facets" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the dark pupil facets (that are np.NaN in the with_keys files), to 0.
This correction can only be performed in case use_keys = True.
Otherwise, nothing is done
This should be used for SLIE/DT scaling to ensure that the sum of all losses adds up to the SLIE/DT loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer</strong> – dictionary containing the luer image</p></li>
<li><p><strong>use_keys</strong> – indicator of the format of the luer (default=False)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with the luer with updated intensities</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.determine_roi_contributions">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">determine_roi_contributions</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">luer_dict</em>, <em class="sig-param">reference</em>, <em class="sig-param">roi_dict</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">verbose=False</em>, <em class="sig-param">analyze_stains=True</em>, <em class="sig-param">conf=None</em>, <em class="sig-param">custom_dir=None</em>, <em class="sig-param">ref_scaling_method=None</em>, <em class="sig-param">use_first_stain_area=False</em>, <em class="sig-param">compensate_shift=False</em>, <em class="sig-param">sigma_correction=True</em>, <em class="sig-param">sigma_correction_factor=2</em>, <em class="sig-param">icrm=False</em>, <em class="sig-param">min_bound_correction=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#determine_roi_contributions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.determine_roi_contributions" title="Permalink to this definition">¶</a></dt>
<dd><p>This function calculates the contribution per ROI,
given a luer_dict including scaling information and a set of roi’s.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>luer_dict</strong> – dictionary containing luers to process, scaling factors, etc.</p></li>
<li><p><strong>reference</strong> – dictionary containing the reference image</p></li>
<li><p><strong>roi_dict</strong> – dictionary with roi definitions. The dictionary contains one roi per key.
Each roi contains ‘type’ (polygon, polar_bounds) and a set of keys depending on the type.</p></li>
<li><p><strong>use_keys</strong> – switch to use with_keys format for with_dots luer_dict files</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
<li><p><strong>analyze_stains</strong> – provide extensive extra info + plots on the generic reference scale in the results file</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>custom_dir</strong> – custom directory to store images/analysis results</p></li>
<li><p><strong>ref_scaling_method</strong> – method to scale the reference to the right global reflectivity value</p></li>
<li><p><strong>use_first_stain_area</strong> – only use the stains detected in the first luer for processing the other luers</p></li>
<li><p><strong>compensate_shift</strong> – instead of SLIEDT, always scale the images compared to generic reference</p></li>
<li><p><strong>sigma_correction</strong> – correct for widening in reflectivity distribution of the non-stain area</p></li>
<li><p><strong>sigma_correction_factor</strong> – select at what sigma level to fixate the correction (e.g. 1 sigma or 2 sigma)</p></li>
<li><p><strong>icrm</strong> – use icrm data instead of SLIE/DT</p></li>
<li><p><strong>min_bound_correction</strong> – use a specific width of a histogram (e.g. from the first LUER) to correct the min-bound
for stain detection</p></li>
</ul>
</dd>
<dt class="field-even">Return dataframe</dt>
<dd class="field-even"><p>with loss per roi. The key should be the luer_dict timestamp.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.generate_analysis_results">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">generate_analysis_results</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">luer</em>, <em class="sig-param">reference</em>, <em class="sig-param">custom_dir</em>, <em class="sig-param">conf</em>, <em class="sig-param">ref_scaling_method</em>, <em class="sig-param">loss_per_roi</em>, <em class="sig-param">parameters</em>, <em class="sig-param">use_first_stain_area</em>, <em class="sig-param">stain_range</em>, <em class="sig-param">n_keys</em>, <em class="sig-param">parameters_first=None</em>, <em class="sig-param">icrm=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#generate_analysis_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.generate_analysis_results" title="Permalink to this definition">¶</a></dt>
<dd><p>This generates analysis results, including:
* Local reflectivity histogram
* RADON reflectivity image
* RADON reflectivity image - stain area marked with white
If more than one image:
* SLIEDT + non-stain local reflectivity evolution
* ROI (stain/non stain) contribution to global loss evolution</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>luer</strong> – luer information including intensity, reflectivity</p></li>
<li><p><strong>reference</strong> – reference information including intensity, reflectivity</p></li>
<li><p><strong>custom_dir</strong> – custom directory to store images/analysis results</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>ref_scaling_method</strong> – refernece scaling method</p></li>
<li><p><strong>loss_per_roi</strong> – dataframe with the end results on reflectivity per ler</p></li>
<li><p><strong>parameters</strong> – dataframe with various values associated to the scaling method of the current LUER</p></li>
<li><p><strong>use_first_stain_area</strong> – fixate the stain vs non-stain region using the first luer</p></li>
<li><p><strong>stain_range</strong> – indices of locations of collector area with a stain</p></li>
<li><p><strong>n_keys</strong> – total number of luers</p></li>
<li><p><strong>parameters_first</strong> – dataframe with various values associated to the scaling method of the first LUER</p></li>
<li><p><strong>icrm</strong> – use icrm data instead of SLIE/DT</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.get_predefined_rois">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">get_predefined_rois</code><span class="sig-paren">(</span><em class="sig-param">roi_definition='spiderweb'</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#get_predefined_rois"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.get_predefined_rois" title="Permalink to this definition">¶</a></dt>
<dd><p>Load roi definitions from a json file. Depending on the value of roi_definition it loads:
- ‘spiderweb’: the 60 spiderweb elements
- ‘rois_from_field’: a few roi definitions based on commonly observed roi patterns in the field</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>roi_definition</strong> – string refering to the predifined roi definition</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – not supported roi definition</p>
</dd>
<dt class="field-odd">Return dictionary</dt>
<dd class="field-odd"><p>with the rois</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.get_roi_mask">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">get_roi_mask</code><span class="sig-paren">(</span><em class="sig-param">luer</em>, <em class="sig-param">roi</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#get_roi_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.get_roi_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the mask that selects the datapoints within the specified region of interest
The roi can be defined by a polygon (‘format’ = ‘polygon’), or by limits in polar coordinates (‘format’ = ‘polar’)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer</strong> – dictionary containing the luer image</p></li>
<li><p><strong>roi</strong> – dictionary containing the roi</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Return mask</dt>
<dd class="field-even"><p>dictionary containing the mask for the LUER image</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_roi.scale_generic_ref">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_roi.</code><code class="sig-name descname">scale_generic_ref</code><span class="sig-paren">(</span><em class="sig-param">reference</em>, <em class="sig-param">luer</em>, <em class="sig-param">ref_scaling_method='clean_area'</em>, <em class="sig-param">conf=None</em>, <em class="sig-param">custom_dir=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_roi.html#scale_generic_ref"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_roi.scale_generic_ref" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to calibrate the intenstiy of the generic ref and to estimate its reflectivity.
For this, it uses the reference scaling method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reference</strong> – dictionary containing the reference image</p></li>
<li><p><strong>luer</strong> – dictionary containing luers to process, scaling factors, etc.</p></li>
<li><p><strong>ref_scaling_method</strong> – method to scale</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>custom_dir</strong> – custom directory to store images/analysis results</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>reference: the scaled reference dataframe</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-pyeuv.Collector.Radon.radon_io"></span><p>radon_io.py
Authors: RWKL
Date: 2019-05-12</p>
<p>Part of this code is extracted from the unblurred radon tool, originally developed by JBKH
This code handles reading in different radon related files, such as ‘.raw’, ‘with_dots.dat’, and ‘with_keys.dat’</p>
<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.connect_scaling_factors_to_influx_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">connect_scaling_factors_to_influx_data</code><span class="sig-paren">(</span><em class="sig-param">scaling_factors</em>, <em class="sig-param">client</em>, <em class="sig-param">conf</em>, <em class="sig-param">start_time</em>, <em class="sig-param">icrm=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#connect_scaling_factors_to_influx_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.connect_scaling_factors_to_influx_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Add additional collector pulse count and scanner pulse count to the LUERs from InfluxDB.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scaling_factors</strong> – dataframe with scaling factors [0 - threshold_upper/100]</p></li>
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>start_time</strong> – luer start time</p></li>
<li><p><strong>icrm</strong> – use icrm data instead of SLIE/DT</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with scaling factors [0 - threshold_upper/100] + scanner/collector pulse count data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.convert_encoded_bitmap_to_lurado_image">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">convert_encoded_bitmap_to_lurado_image</code><span class="sig-paren">(</span><em class="sig-param">encoded_bitmap</em>, <em class="sig-param">image_type</em>, <em class="sig-param">reference=None</em>, <em class="sig-param">threshold=1.2</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#convert_encoded_bitmap_to_lurado_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.convert_encoded_bitmap_to_lurado_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert an encoded bitmap with intensities or reflectivities to a lurado image
The lurado image is a 2d numpy array (256x256) with positive x-axis to the left, and positive y-axis down
A bitmap image has its origin on the top left, so positive x-axis to the right, and positive y-axis down</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>encoded_bitmap</strong> – 8bit encoded bitmap</p></li>
<li><p><strong>image_type</strong> – type of image. Options are ‘intensity’, ‘reflectivity’, ‘no_scaling’</p></li>
<li><p><strong>reference</strong> – reference image (dataframe) with columns ‘x’, ‘y’, ‘intensity’, only required for ‘intensity’</p></li>
<li><p><strong>threshold</strong> – threshold factor resulting in a threshold value to which the image is clipped (default: 1.2)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>lurado image (2d array)</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p>exception when incorrect image type is passed or reference is not provided</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.convert_lurado_image_to_encoded_bitmap">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">convert_lurado_image_to_encoded_bitmap</code><span class="sig-paren">(</span><em class="sig-param">lurado_image</em>, <em class="sig-param">image_type</em>, <em class="sig-param">reference=None</em>, <em class="sig-param">threshold=1.2</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#convert_lurado_image_to_encoded_bitmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.convert_lurado_image_to_encoded_bitmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a lurado image with intensities or reflectivities into an encoded string representation of a png
The lurado image is a 2d numpy array (256x256) with positive x-axis to the left, and positive y-axis down
A bitmap image has its origin on the top left, so positive x-axis to the right, and positive y-axis down</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lurado_image</strong> – lurado formatted 2d array</p></li>
<li><p><strong>image_type</strong> – type of image. Options are ‘intensity’, ‘reflectivity’, ‘no_scaling’</p></li>
<li><p><strong>reference</strong> – reference image (dataframe) with columns ‘x’, ‘y’, ‘intensity’, only required for ‘intensity’</p></li>
<li><p><strong>threshold</strong> – threshold factor resulting in a threshold value to which the image is clipped (default: 1.2)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>encoded string containing the png image</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p>exception when incorrect image type is passed or reference is not provided</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.convert_string_to_int">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">convert_string_to_int</code><span class="sig-paren">(</span><em class="sig-param">index_string</em>, <em class="sig-param">length=4</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#convert_string_to_int"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.convert_string_to_int" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a string to an integer, and throws an error in case it fails</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>index_string</strong> – String to be converted</p></li>
<li><p><strong>length</strong> – length of the string, by default 4.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>integer value</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_index_from_raw_luer">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_index_from_raw_luer</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_index_from_raw_luer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_index_from_raw_luer" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract LUER index from a raw LUER file name. Raises an exception when unsuccessful</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer index</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_index_from_with_dots_luer">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_index_from_with_dots_luer</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_index_from_with_dots_luer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_index_from_with_dots_luer" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract LUER index from a processed LUER file name. Raises an exception when unsuccessful</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the with_dots luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer index</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_index_from_with_keys_luer">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_index_from_with_keys_luer</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_index_from_with_keys_luer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_index_from_with_keys_luer" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract LUER index from a processed LUER with_keys file name. Raises an exception when unsuccessful</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the with_dots luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer index</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_key_from_raw_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_key_from_raw_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_key_from_raw_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_key_from_raw_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract key from a raw LUER file name. Raises an exception when unsuccessful
The key is the timestamp in the filename, when available (3400), otherwise, it is the index</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>unique key</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_line_from_file_with_tag">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_line_from_file_with_tag</code><span class="sig-paren">(</span><em class="sig-param">file_handler</em>, <em class="sig-param">tag</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_line_from_file_with_tag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_line_from_file_with_tag" title="Permalink to this definition">¶</a></dt>
<dd><p>Scans a file for a tag and returns the first occurrence of that tag</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_handler</strong> – file handler</p></li>
<li><p><strong>tag</strong> – tag to search for</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>line  of first occurence of tag</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_line_with_tag_from_luer_raw">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_line_with_tag_from_luer_raw</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">tag</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_line_with_tag_from_luer_raw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_line_with_tag_from_luer_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the first line containing the tag from a raw luer file. Raises an exception when unsuccessful</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer</p></li>
<li><p><strong>tag</strong> – the string we look for in the file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>pandas timestamp</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_luer_dict_object">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_luer_dict_object</code><span class="sig-paren">(</span><em class="sig-param">luer_data</em>, <em class="sig-param">raw_filename=None</em>, <em class="sig-param">raw_file_object=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_luer_dict_object"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_luer_dict_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a dictionary containing the luer_data and other supporting metadata</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_data</strong> – dataframe containing the luer data</p></li>
<li><p><strong>raw_filename</strong> – full path to the luer raw file</p></li>
<li><p><strong>raw_file_object</strong> – handle to the raw file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with luer data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_luer_with_dots_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_luer_with_dots_filename</code><span class="sig-paren">(</span><em class="sig-param">path_raw</em>, <em class="sig-param">include_machine_name=False</em>, <em class="sig-param">with_keys=True</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_luer_with_dots_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_luer_with_dots_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the luer with keys filename.
In the cache (EUV-DB backend) it should include the machine_number, since the cache is a flat dump:
- LUER_m1234_201906300020.0123.raw –&gt; LUER.m1234.201906300020.0123_SN_FAR_FIELD_WITH_DOTS_WITH_KEYS.dat
On the CPR it should not  include the machine_number:
- LUER_m1234_201906300020.0123.raw –&gt; LUER.201906300020.0123_SN_FAR_FIELD_WITH_DOTS_WITH_KEYS.dat</p>
<p>Use the raw filename to extract the information.
In case the raw file does not have it (for instance for the 33X0s),
extract the timestamp from the content of the file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path_raw</strong> – the full path to the raw luer file</p></li>
<li><p><strong>include_machine_name</strong> – Option to include the machine number in the luer output filename (default: False)</p></li>
<li><p><strong>with_keys</strong> – switch post-fix to include ‘WITH_KEYS’ (default: True)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p>Exception if filename_raw has incorrect format (in filename and content) or does not exist</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_machine_id_from_luer_raw">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_machine_id_from_luer_raw</code><span class="sig-paren">(</span><em class="sig-param">filename=None</em>, <em class="sig-param">file_handler=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_machine_id_from_luer_raw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_machine_id_from_luer_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the machine id from a raw luer file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer</p></li>
<li><p><strong>file_handler</strong> – file object of the raw luer</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string machine number</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p>exception when filename cannot be opened or extraction of machine_id fails</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_pma_luer_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_pma_luer_directory</code><span class="sig-paren">(</span><em class="sig-param">root</em>, <em class="sig-param">machine_nr</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_pma_luer_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_pma_luer_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the full path of the LUER files on PMA, given the PMA root directory, and the machine number</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root</strong> – The PMA root directory (the mapped network drive (e.g. ‘v:’) or mounted disk (e.g. ‘/pma’)</p></li>
<li><p><strong>machine_nr</strong> – the 4 character machine number (so without the ‘m’ in front)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The full path of the LUER files at PMA for this machine</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_pulse_count_from_luer_raw">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_pulse_count_from_luer_raw</code><span class="sig-paren">(</span><em class="sig-param">filename=None</em>, <em class="sig-param">file_handler=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_pulse_count_from_luer_raw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_pulse_count_from_luer_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the pulse_count from a raw luer file. Raises an exception when unsuccessful</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer</p></li>
<li><p><strong>file_handler</strong> – file object of the raw luer</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>pulse count</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_reference_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_reference_directory</code><span class="sig-paren">(</span><em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_reference_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_reference_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns directory name which contains generic references.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> – switches debug mode (default=False)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>directory of reference file</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_roi_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_roi_directory</code><span class="sig-paren">(</span><em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_roi_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_roi_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns directory name which contains generic roi definition files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> – switches debug mode (default=False)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>directory of generic roi definition files</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_timestamp_from_luer_raw">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_timestamp_from_luer_raw</code><span class="sig-paren">(</span><em class="sig-param">filename=None</em>, <em class="sig-param">file_handler=None</em>, <em class="sig-param">from_header=False</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_timestamp_from_luer_raw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_timestamp_from_luer_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the timestamp from a raw luer file. Raises an exception when unsuccessful
By default it takes the timestamp from the body, at the measurement.
This timestamp includes timezone information and is at the start of the LUER measurement</p>
<p>If from_header is True, the timezone from the header is taken.
This timestamp is in local time, and at the end of the measurement. This is the timezone used in the LUER filename</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer</p></li>
<li><p><strong>file_handler</strong> – file object of the raw luer</p></li>
<li><p><strong>from_header</strong> – extract the timestamp from the header (default: False)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>pandas timestamp</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_timestamp_from_processed_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_timestamp_from_processed_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_timestamp_from_processed_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_timestamp_from_processed_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract timestamp from a processec LUER file name. Raises an exception when unsuccessful
The timestamp is only available in the 3400s and beyond</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>timestamp string (‘YYYYMMDDHHMMSS’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.get_timestamp_from_raw_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">get_timestamp_from_raw_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#get_timestamp_from_raw_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.get_timestamp_from_raw_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract timestamp from a raw LUER file name. Raises an exception when unsuccessful
The timestamp is only available in the 3400s and beyond</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the raw luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>timestamp string (‘YYYYMMDDHHMMSS’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.is_valid_raw_luer_file">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">is_valid_raw_luer_file</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#is_valid_raw_luer_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.is_valid_raw_luer_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate both the filename and some of the content of a raw luer file.
It checks for:
- valid filename format
- valid content –&gt; checksum field should be available and not an empty string
- valid content –&gt; should contain tag ‘time_data’</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the path in which the raw luer is stored</p></li>
<li><p><strong>filename</strong> – character string of the filename of theraw luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.is_valid_raw_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">is_valid_raw_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#is_valid_raw_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.is_valid_raw_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate format of raw LUER file name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of theraw luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.is_valid_with_dots_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">is_valid_with_dots_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#is_valid_with_dots_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.is_valid_with_dots_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate format of with dots LUER file name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the with_dots luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.is_valid_with_keys_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">is_valid_with_keys_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#is_valid_with_keys_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.is_valid_with_keys_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate format of with keys LUER file name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – character string of the filename of the with_keys luer.</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.load_dots">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">load_dots</code><span class="sig-paren">(</span><em class="sig-param">luer_file</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">remove_zeros=True</em>, <em class="sig-param">dark_facets_to_zero=True</em>, <em class="sig-param">verbose=False</em>, <em class="sig-param">correct_ffm=False</em>, <em class="sig-param">ffm_window=5</em>, <em class="sig-param">blurred=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#load_dots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.load_dots" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a luer with_dots file.
It takes care of the x and y coordinate transformation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_file</strong> – full path of the luer file to be loaded</p></li>
<li><p><strong>use_keys</strong> – switch to read old format (x, y, i), versus new format ()</p></li>
<li><p><strong>remove_zeros</strong> – for luer output without keys, the data is snapped to a uniform grid. Where there is no data,
the grid contains zeros. By default, we remove them. However, when using it to make a bitmap, the zeros should
not be thrown away. (default: True)</p></li>
<li><p><strong>dark_facets_to_zero</strong> – switch to set dark facets from nan to 0, only when using keys (default: True)</p></li>
<li><p><strong>correct_ffm</strong> – correct for varying intensity of the field-facet mirrors</p></li>
<li><p><strong>ffm_window</strong> – smoothing window for intensity smoothing field-facet mirrors</p></li>
<li><p><strong>blurred</strong> – blur radon image</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with columns x, y and intensity</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.load_luer_list">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">load_luer_list</code><span class="sig-paren">(</span><em class="sig-param">radon_directory</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">dark_facets_to_zero=False</em>, <em class="sig-param">luers_to_ignore=[]</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#load_luer_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.load_luer_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads all processed luers within the provided directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>radon_directory</strong> – The radon directory</p></li>
<li><p><strong>use_keys</strong> – switch to load with_keys files, otherwise loads dots (default: True)</p></li>
<li><p><strong>dark_facets_to_zero</strong> – switch to set dark facets from nan to 0 (default: False)</p></li>
<li><p><strong>luers_to_ignore</strong> – list of luer keys to ignore (default: [])</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with all luer images. The timestamp, if available in the .dat filename, as key.
otherwise luer index as key.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.load_reflectivity_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">load_reflectivity_data</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">conf</em>, <em class="sig-param">timestamp</em>, <em class="sig-param">icrm=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#load_reflectivity_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.load_reflectivity_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Load all SLIE/DT data, including pulse count data from InfluxDB</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>conf</strong> – object with machine/collector info</p></li>
<li><p><strong>luer</strong> – luer information including intensity, reflectivity</p></li>
<li><p><strong>icrm</strong> – use icrm data instead of SLIE/DT</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.read_ffm_module_info_from_json">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">read_ffm_module_info_from_json</code><span class="sig-paren">(</span><em class="sig-param">json_file</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#read_ffm_module_info_from_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.read_ffm_module_info_from_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Read ffm module ids from json file and return it as a dict.
:param json_file: full path to json file
:param verbose: switches debug mode (default=False)
:return: dictionary with ffm ranges for each module</p>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.save_dots">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">save_dots</code><span class="sig-paren">(</span><em class="sig-param">luer_data</em>, <em class="sig-param">filename</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#save_dots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.save_dots" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves a luer with_dots file.
It takes care of the x and y coordinate transformation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_data</strong> – </p></li>
<li><p><strong>filename</strong> – full path of the luer file to be saved</p></li>
<li><p><strong>use_keys</strong> – switch to read old format (index, x, y, i), versus new format (key, x, y, i)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p>Exception if writing to disk fails</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_io.validate_format_of_luer_filename">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_io.</code><code class="sig-name descname">validate_format_of_luer_filename</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">prefix</em>, <em class="sig-param">suffix</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_io.html#validate_format_of_luer_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_io.validate_format_of_luer_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Validates the format of the luer filename and throws an exception in case it fails.
It tests for correct prefix, suffix and 3 chunks when splitting on ‘.’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – filename to be validated</p></li>
<li><p><strong>prefix</strong> – expected start of the filename</p></li>
<li><p><strong>suffix</strong> – expected end of the filename</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-pyeuv.Collector.Radon.radon_scaling"></span><p>radon_scaling.py
Authors: RWKL, JJCW
Date:  2019-05-12</p>
<p>This module releases functions for different scaling algorithms for radon images.
It includes various implementations for slie/dt based scaling, and intensity based scaling</p>
<p>New functions (DAAU): get_scaling_factor_from_intensities, pre_scale_reflectivity, determine_approx_position_peak, narrow_down_region_near_peak
gaussian, fit_gaussian_peak, determine_stain_area, calculate_intensity_ratio
Date:  2020-06-02</p>
<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.calculate_intensity_ratio">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">calculate_intensity_ratio</code><span class="sig-paren">(</span><em class="sig-param">luer_intensity</em>, <em class="sig-param">reference_intensity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#calculate_intensity_ratio"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.calculate_intensity_ratio" title="Permalink to this definition">¶</a></dt>
<dd><p>This function calculates the reflectivity based on the intensity ratio of the luer with its reference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_intensity</strong> – intensity of luer</p></li>
<li><p><strong>reference_intensity</strong> – intensity of reference luer</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>return</dt><dd><p>intensity_ratio: the intensity ratio</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.calculate_min_max_compensation_factor">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">calculate_min_max_compensation_factor</code><span class="sig-paren">(</span><em class="sig-param">peak_reflectivity</em>, <em class="sig-param">sigma_peak</em>, <em class="sig-param">ref_scaling_method</em>, <em class="sig-param">sigma_correction_factor=2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#calculate_min_max_compensation_factor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.calculate_min_max_compensation_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the compensation factor for the Gaussian fit for the case of a smaller peak width (loss = upper bound / max),
and larger or maximum peak width (loss = lower limit / min).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>peak_reflectivity</strong> – the reflectivity at the peak of the histogram</p></li>
<li><p><strong>sigma_peak</strong> – sigma of the peak</p></li>
<li><p><strong>ref_scaling_method</strong> – method to scale the reference to the right global reflectivity value</p></li>
<li><p><strong>sigma_correction_factor</strong> – select at what sigma level to fixate the correction (e.g. 1 sigma or 2 sigma)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>compensation_factor: factor to compenate the Gaussian peak position with</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.determine_approx_position_peak">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">determine_approx_position_peak</code><span class="sig-paren">(</span><em class="sig-param">counts</em>, <em class="sig-param">bins</em>, <em class="sig-param">min_bound</em>, <em class="sig-param">percentage_max</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#determine_approx_position_peak"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.determine_approx_position_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine approximately where the peak of the non-stain area is by considering a minimum for the reflectivity value
and a minimum for the counts (&gt; above percentage_max).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>counts</strong> – the counts of the histogram</p></li>
<li><p><strong>bins</strong> – the bins of the histogram</p></li>
<li><p><strong>min_bound</strong> – lower limit of clean area in terms of reflectivity</p></li>
<li><p><strong>percentage_max</strong> – percentage of the maximum the histogram, used to recognize the peak</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>approx_position_peak: indices of approximate location of the non-stain peak</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.determine_location_initial_distribution">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">determine_location_initial_distribution</code><span class="sig-paren">(</span><em class="sig-param">bins</em>, <em class="sig-param">counts</em>, <em class="sig-param">initial_peak_reflectivity</em>, <em class="sig-param">initial_sigma_peak</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#determine_location_initial_distribution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.determine_location_initial_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Correct the Gaussian distribution based on the intial fit</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bins</strong> – bins of the histogram</p></li>
<li><p><strong>counts</strong> – counts of the histogram</p></li>
<li><p><strong>initial_peak_reflectivity</strong> – center of initial distribution</p></li>
<li><p><strong>initial_sigma_peak</strong> – sigma_peak of initial distribution</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>popt: final fitting parameters</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.determine_stain_area">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">determine_stain_area</code><span class="sig-paren">(</span><em class="sig-param">counts</em>, <em class="sig-param">bins</em>, <em class="sig-param">peak_reflectivity</em>, <em class="sig-param">sigma_peak</em>, <em class="sig-param">popt</em>, <em class="sig-param">n_avg=4</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#determine_stain_area"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.determine_stain_area" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the stain region using the intersection of the averaged remainder of the data after subtraction of the
Gauss fit and the fit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bins</strong> – the bins of the histogram</p></li>
<li><p><strong>peak_reflectivity</strong> – the reflectivity at the peak of the histogram</p></li>
<li><p><strong>sigma_peak</strong> – sigma of the peak</p></li>
</ul>
</dd>
</dl>
<p>popt: final fitting parameters
:param n_avg: number of datapoint to average/smooth over
:return:</p>
<blockquote>
<div><p>df_remainder: remainder of histogram after subtraction of the fit
min_bound: lower limit of clean area in terms of reflectivity</p>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.fit_gaussian_peak">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">fit_gaussian_peak</code><span class="sig-paren">(</span><em class="sig-param">counts</em>, <em class="sig-param">bins</em>, <em class="sig-param">reflectivity</em>, <em class="sig-param">fit_range</em>, <em class="sig-param">min_bound</em>, <em class="sig-param">fit_min_x</em>, <em class="sig-param">fit_max_x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#fit_gaussian_peak"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.fit_gaussian_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the Gaussian peak of the histogram.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>counts</strong> – the counts of the histogram</p></li>
<li><p><strong>bins</strong> – the bins of the histogram</p></li>
<li><p><strong>reflectivity</strong> – the raw reflectivity values</p></li>
<li><p><strong>fit_range</strong> – range to be fitted</p></li>
<li><p><strong>min_bound</strong> – lower limit of clean area in terms of reflectivity</p></li>
<li><p><strong>fit_min_x</strong> – the lower bound x-values (reflectivity) for fitting</p></li>
<li><p><strong>fit_max_x</strong> – the upper bound x-values (reflectivity) for fitting</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>peak_reflectivity: the reflectivity at the peak of the histogram
error_peak: the error in the value of peak_reflectivity
sigma_peak: sigma of the peak
amplitude_peak: amplitude of the peak
popt: final fitting parameters
pcov: additional data on fitting (incl. errors)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.gaussian">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">gaussian</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">A</em>, <em class="sig-param">x0</em>, <em class="sig-param">sig</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#gaussian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.gaussian" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate a Gaussian curve using given parameters and the position on the x-axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – position on the x-axis</p></li>
<li><p><strong>A</strong> – amplitude</p></li>
<li><p><strong>x0</strong> – off-set in x-direction</p></li>
<li><p><strong>sig</strong> – sigma of the distribution</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>funct: y-value belong to the x-value</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.get_min_max_sigma_values">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">get_min_max_sigma_values</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#get_min_max_sigma_values"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.get_min_max_sigma_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Get values for the min and max sigma population data of the width of the reflectivity histogram. See EPS D000884328-00</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>min and max sigma estimates of the width of the reflectivity histogram</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.get_scaling">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">get_scaling</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">luer_timestamps</em>, <em class="sig-param">reflectivity_data=None</em>, <em class="sig-param">scaling_method='sliedt_interpolate'</em>, <em class="sig-param">threshold_upper=110.0</em>, <em class="sig-param">use_sg_filtering=False</em>, <em class="sig-param">verbose=False</em>, <em class="sig-param">icrm=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#get_scaling"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.get_scaling" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the scaling factor for a luer file. Different scaling methods can be applied.
Implemented scaling methods are:</p>
<ul class="simple">
<li><p>no_scaling: returning 1.0</p></li>
<li><p>sliedt_ffill: forward fill the slie/dt to the luer timestamp. In case no slie/dt is available, return 1.0</p></li>
<li><p>sliedt_interpolate : linear (in time dimension) interpolate slie/dt at the luer timestamp.</p></li>
<li><p>sliedt_nearest : nearest slie/dt value to the luer timestamp.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> (<em>instance</em>) – instance of Network connection (UserLANClient)</p></li>
<li><p><strong>source_id</strong> (<em>str</em>) – source number (eg. s44481)</p></li>
<li><p><strong>luer_timestamps</strong> (<em>list of pandas timestamps</em>) – timestamp of LUER</p></li>
<li><p><strong>reflectivity_data</strong> (<em>pandas Dataframe</em>) – dataframe with reflectivity values in the ‘slie_dt’ column, and timestamps in the index</p></li>
<li><p><strong>scaling_method</strong> – method for scaling</p></li>
<li><p><strong>threshold_upper</strong> (<em>float</em>) – upper threshold for reflectivity</p></li>
<li><p><strong>use_sg_filtering</strong> (<em>boolean</em>) – switch to turn on the sg filter for slie/dt (default=False)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
<li><p><strong>icrm</strong> – use icrm data instead of SLIE/DT</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – not supported scaling method</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>scaling factor ~1.0</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.get_scaling_factor_from_intensities">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">get_scaling_factor_from_intensities</code><span class="sig-paren">(</span><em class="sig-param">luer_intensity</em>, <em class="sig-param">reference_intensity</em>, <em class="sig-param">ref_scaling_method='clean_area'</em>, <em class="sig-param">min_bound=0.619</em>, <em class="sig-param">max_bound=2.5</em>, <em class="sig-param">n_bins=150</em>, <em class="sig-param">min_bin=3</em>, <em class="sig-param">percentage_max=0.45</em>, <em class="sig-param">fit_min_x=0.5</em>, <em class="sig-param">fit_max_x=1.7</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#get_scaling_factor_from_intensities"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.get_scaling_factor_from_intensities" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the calibration factor by computing the average intensity ratio (over all pixels) between the currect
luer and the reference. It does this by two methods:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>taking the median of the intensity ratios bounded by a min and max value.</p></li>
</ol>
<p>2) fitting the peak in the reflectivity histogram due to non-stains (=clean area) by a Gaussian, and taking the
mu of the peak.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_intensity</strong> – intensity map of the current luer</p></li>
<li><p><strong>reference_intensity</strong> – intensity map of the reference</p></li>
<li><p><strong>ref_scaling_method</strong> – method to scale the reference to the right global reflectivity value</p></li>
<li><p><strong>min_bound</strong> – minimum value for intensity</p></li>
<li><p><strong>max_bound</strong> – maximum value for intensity</p></li>
<li><p><strong>n_bins</strong> – number of bins for the histogram</p></li>
<li><p><strong>min_bin</strong> – minimum number of bins of a peak in the histogram to be counted as a meaningful</p></li>
<li><p><strong>percentage_max</strong> – percentage of the maximum the histogram, used to recognize the peak</p></li>
<li><p><strong>fit_min_x</strong> – the lower bound x-values (reflectivity) for fitting</p></li>
<li><p><strong>fit_max_x</strong> – the upper bound x-values (reflectivity) for fitting</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>parameters: dataframe with various values associated to the scaling method</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.get_scaling_factor_from_sliedt">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">get_scaling_factor_from_sliedt</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">luer_timestamps</em>, <em class="sig-param">reflectivity_data=None</em>, <em class="sig-param">method='sliedt_interpolate'</em>, <em class="sig-param">threshold_upper=110.0</em>, <em class="sig-param">use_sg_filtering=False</em>, <em class="sig-param">verbose=False</em>, <em class="sig-param">icrm=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#get_scaling_factor_from_sliedt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.get_scaling_factor_from_sliedt" title="Permalink to this definition">¶</a></dt>
<dd><p>This function retrieves scaling_factor for a LUER measurement timestamp.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>if there’s no collector swap signal ; return 1.0</p></li>
<li><p>if there’s no SLIE/DT measurement between collector swap and LUER measurement; return 1.0</p></li>
<li><p>remove invalid SLIE/DT data (above threshold_upper)</p></li>
<li><ol class="loweralpha simple">
<li><p>if method is ‘sliedt_interpolate’, linear interpolate SLIE/DT to luer timestamps (in the time domain)</p></li>
<li><p>if method is ‘sliedt_nearest’, take SLIE/DT nearest to luer timestamps</p></li>
<li><p>if method is ‘sliedt_ffill’, continue at next step, since this step will perform it implicitly</p></li>
</ol>
</li>
<li><p>forward fill the SLIE/DT data to the luer timestamps after the last SLIE/DT data</p></li>
<li><p>backward fill SLIE/DT to the luer timestamps before the first SLIE/DT data</p></li>
</ol>
</div></blockquote>
<p>You can choose SG filtered and non SG-filtered SLIE/DT</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> (<em>instance</em>) – instance of Network connection (UserLANClient)</p></li>
<li><p><strong>source_id</strong> (<em>str</em>) – source number (eg. s44481)</p></li>
<li><p><strong>luer_timestamps</strong> (<em>pandas timestamp</em>) – timestamp of LUER</p></li>
<li><p><strong>reflectivity_data</strong> (<em>pandas Dataframe</em>) – dataframe with reflectivity values in the ‘slie_dt’ column, and timestamps in the index</p></li>
<li><p><strong>method</strong> – method of mapping SLIE/DT to the luer timestamps (default:’interpolate’)</p></li>
<li><p><strong>threshold_upper</strong> (<em>float</em>) – upper threshold for reflectivity</p></li>
<li><p><strong>use_sg_filtering</strong> (<em>boolean</em>) – switch to turn on the sg filter for slie/dt (default=False)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
<li><p><strong>icrm</strong> (<em>boolean</em>) – use icrm data instead of SLIE/DT</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with scaling factors [0 - threshold_upper/100]</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>Exception</strong> – data retrieval from influx fails.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.get_sliedt_signal_dict">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">get_sliedt_signal_dict</code><span class="sig-paren">(</span><em class="sig-param">use_sg_filtering=False</em>, <em class="sig-param">verbose=False</em>, <em class="sig-param">icrm=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#get_sliedt_signal_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.get_sliedt_signal_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Returning a dictionary with ‘reflectivity’ as the key, and the slie/dt signal name as value.
The slie/dt signal name depends on using the SG filtering.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>use_sg_filtering</strong> (<em>boolean</em>) – use / skip SG filter for slie/dt (default=False: skip SG filter)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
<li><p><strong>icrm</strong> (<em>boolean</em>) – use icrm data instead of SLIE/DT</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with ‘reflectivity’ as key, and the influx signal name as value</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.narrow_down_region_near_peak">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">narrow_down_region_near_peak</code><span class="sig-paren">(</span><em class="sig-param">counts</em>, <em class="sig-param">bins</em>, <em class="sig-param">approx_position_peak</em>, <em class="sig-param">n_avg=3</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#narrow_down_region_near_peak"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.narrow_down_region_near_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Smooth the data and find the first peak from the right, and - if present - a local minimum left of the peak.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>counts</strong> – the counts of the histogram</p></li>
<li><p><strong>bins</strong> – the bins of the histogram</p></li>
<li><p><strong>approx_position_peak</strong> – indices of approximate location of the non-stain peak</p></li>
<li><p><strong>n_avg</strong> – window for smoothing</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>approx_position_peak: indices of approximate location of the non-stain peak</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_scaling.pre_scale_reflectivity">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_scaling.</code><code class="sig-name descname">pre_scale_reflectivity</code><span class="sig-paren">(</span><em class="sig-param">reflectivity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_scaling.html#pre_scale_reflectivity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_scaling.pre_scale_reflectivity" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter out hot-spots by taking values below the 98% percentile and than find the approximate peak of the distribution
by considering an offset, based on population data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>reflectivity</strong> – the raw reflectivity values</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>pre_calibration_factor: ratio used for the initial reference scaling</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-pyeuv.Collector.Radon.radon_reference_image"></span><p>radon_reference_image.py
Authors: RWKL, JJCW
Date:  2019-05-12
Last modified : 2019-08-29</p>
<p>This module facilitates functionality to obtain a reference image to be used in the radon_roi calculation,
and contains functionality to generate a generic reference image.</p>
<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_reference_image.get_first_luer_from_share_drive">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_reference_image.</code><code class="sig-name descname">get_first_luer_from_share_drive</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">start_time</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_reference_image.html#get_first_luer_from_share_drive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_reference_image.get_first_luer_from_share_drive" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks luers on CPR sharedrive, and determines the first luer of the collector</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>source_id</strong> – source id of system for which we are calculating the ROI contributions</p></li>
<li><p><strong>start_time</strong> – start time, to be used for some of the reference types</p></li>
<li><p><strong>use_keys</strong> – switch to use with_keys format for with_dots luer files (default=False)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – When Collector.swap could not be received</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radon_reference_image.get_reference">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radon_reference_image.</code><code class="sig-name descname">get_reference</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">start_time=None</em>, <em class="sig-param">reference_type='new_collectors_per_mirror_and_pupil'</em>, <em class="sig-param">use_keys=True</em>, <em class="sig-param">custom_reference_filepath=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radon_reference_image.html#get_reference"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radon_reference_image.get_reference" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns a generic reference, depending on the prescribed reference type.
Implemented reference types are:
- first_luer: first luer of collector
- from_radial_profile: a with_keys luer image for which the intensity is generated by averaged radial profile
- from_radial_profile_blurred : blurred version of ‘from_radial_profile’ (for smoothed image)
- new_collectors_per_mirror_and_pupil : median of new collectors
- new_collectors_per_mirror_and_pupil_blurred : blurred version of new_collectors_per_mirror_and_pupil</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>source_id</strong> – source id of system for which we are calculating the ROI contributions</p></li>
<li><p><strong>start_time</strong> – start time, to be used for some of the reference types</p></li>
<li><p><strong>reference_type</strong> – string to specify what type of reference image has to be used.</p></li>
<li><p><strong>use_keys</strong> – switch to use with_keys format for with_dots luer files (default=True)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>Exception</strong> – not supported reference type</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>reference: dictionary with image data</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-pyeuv.Collector.Radon.roi_io"></span><p>roi_io.py
Authors: RWKL
Date:  2019-05-13</p>
<p>Roi_io contains functionality to read and write ROI definitions from json files into a dict format.
The dictionary contains per unique key one ROI. For ewach ROI, the following properties are defined:
- ‘type’: ‘ROI’
- ‘format’: ‘polar’ or ‘polygon’
- ‘UCC’: 1 means under change control, 0 is not under change control</p>
<p>Depending on the format:
for polar:
- ‘r_min’: the minimum radius (edge excluded, relative radial position)
- ‘r_max’: the maximum radius (edge included, relative radial position)
- ‘phi_min’: the minimum angle (edge excluded, in degrees)
- ‘phi_max’: the maximum angle (edge included, in degrees)</p>
<p>for polygon:
- ‘positions’: [[x0, y0], [x1, y1], …, [xn, yn]] (in absolute coordinates, x0 != xn)</p>
<dl class="function">
<dt id="pyeuv.Collector.Radon.roi_io.read_rois_from_json">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.roi_io.</code><code class="sig-name descname">read_rois_from_json</code><span class="sig-paren">(</span><em class="sig-param">json_file</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/roi_io.html#read_rois_from_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.roi_io.read_rois_from_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Read rois from json file and return it as a dict.
It ignores all json objects of different tpyes than ‘ROI’</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>json_file</strong> – full path to json file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dict containing the ROIs</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p>exception in case file cannot be opened</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p>exception in case json cannot be parsed</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.roi_io.read_spiderweb_kpis_from_json">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.roi_io.</code><code class="sig-name descname">read_spiderweb_kpis_from_json</code><span class="sig-paren">(</span><em class="sig-param">json_file</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/roi_io.html#read_spiderweb_kpis_from_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.roi_io.read_spiderweb_kpis_from_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Read spiderweb KPI mapping from json file and return it as a dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>json_file</strong> – full path to json file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dict containing the spiderweb KPI mapping</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p>exception in case file cannot be opened</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p>exception in case json cannot be parsed</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.roi_io.write_rois_to_json">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.roi_io.</code><code class="sig-name descname">write_rois_to_json</code><span class="sig-paren">(</span><em class="sig-param">roi_dict</em>, <em class="sig-param">json_file</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/roi_io.html#write_rois_to_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.roi_io.write_rois_to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes roi dictionary to a json file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>roi_dict</strong> – The dictionary containing the ROIs</p></li>
<li><p><strong>json_file</strong> – the pfile in which the ROIs should be stored</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-pyeuv.Collector.Radon.shared"></span><p>radon_roi.py
Authors: RWKL
Date:  2019-05-13</p>
<p>Radon shared contains a number of common functionality on luer files</p>
<dl class="function">
<dt id="pyeuv.Collector.Radon.shared.get_normalized_intensity">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.shared.</code><code class="sig-name descname">get_normalized_intensity</code><span class="sig-paren">(</span><em class="sig-param">luer_data</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/shared.html#get_normalized_intensity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.shared.get_normalized_intensity" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the normalized intensity, such that the sum of all intensities equals 1.0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>luer</strong> – dictionary containing a dataframe with luer image data and a format type specification</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing normalized intensities</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.shared.get_normalized_radius">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.shared.</code><code class="sig-name descname">get_normalized_radius</code><span class="sig-paren">(</span><em class="sig-param">luer_df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/shared.html#get_normalized_radius"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.shared.get_normalized_radius" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the normalized radius, given a dataframe with x, y, intensity.
The normalization sets the maximum radius to 1.0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_df</strong> – dataframe (x, y, intensity) of a luer file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>normalized radius</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.shared.get_phi">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.shared.</code><code class="sig-name descname">get_phi</code><span class="sig-paren">(</span><em class="sig-param">luer_df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/shared.html#get_phi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.shared.get_phi" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the phi coordinate in degrees for each datapoint of the luer file.
3 oc equals 0 degrees. 12 oc is 90 degrees, 6 oc is 270 degrees etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_df</strong> – dataframe (x, y, intensity) of a luer file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>normalized radius</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.shared.get_radius">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.shared.</code><code class="sig-name descname">get_radius</code><span class="sig-paren">(</span><em class="sig-param">luer_df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/shared.html#get_radius"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.shared.get_radius" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the radius, given a dataframe with x, y, intensity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_df</strong> – dataframe (x, y, intensity) of a luer file</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>radius</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.shared.phi_to_hour">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.shared.</code><code class="sig-name descname">phi_to_hour</code><span class="sig-paren">(</span><em class="sig-param">phi</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/shared.html#phi_to_hour"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.shared.phi_to_hour" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert phi to an hour representation.
phi = 0 becomes 3.0, phi = 15 becomes 2.5 etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>phi</strong> – float between 0-360, 0 at 3oc, running counterclockwise</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>float value between 0-12 indicating the time on a clock</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="readme-for-static-data-files">
<h2>readme for static data files<a class="headerlink" href="#readme-for-static-data-files" title="Permalink to this headline">¶</a></h2>
<p>Authors: RWKL, JJCW</p>
<p>Date:  2019-06-04</p>
<p><strong>generic_reference_from_radial_profile_of_first_collector_images_3400.dat</strong></p>
<blockquote>
<div><p>This generic reference was generated from radial profile of average of new collectors from several machines.
(Originally created by TBAV)
Format of this file is same for WITH_DOTS_WITH_KEY file which has FFM number and fieldpoint(fp) as index and x, y and
intensity at each point for 3400.</p>
</div></blockquote>
<p><strong>generic_reference_from_radial_profile_of_first_collector_images_3400-blurred.dat</strong></p>
<blockquote>
<div><p>Blurred version of generic_reference_from_radial_profile_of_first_collector_images_3400.dat.</p>
</div></blockquote>
<p><strong>generic_reference_from_radial_profile_of_first_collector_images_33x0.dat</strong></p>
<blockquote>
<div><p>This generic reference was generated from radial profile of average of new collectors from several machines.
(Originally created by TBAV)
Format of this file is same for WITH_DOTS_WITH_KEY file which has FFM number and fieldpoint(fp) as index and x, y and
intensity at each point for 3300 and 3350.</p>
</div></blockquote>
<p><strong>generic_reference_from_radial_profile_of_first_collector_images_33x0-blurred.dat</strong></p>
<blockquote>
<div><p>Blurred version of generic_reference_from_radial_profile_of_first_collector_images_33x0.dat.</p>
</div></blockquote>
<p><strong>generic_reference_median_per_mirror_and_pupil_3400.dat</strong></p>
<blockquote>
<div><p>This generic reference was generated by taking all first luers of new and refurbished collectors.
It takes the median per farfield mirror and pupil combination. This is only availalbe in with_keys format.</p>
</div></blockquote>
<p><strong>generic_reference_median_per_mirror_and_pupil_3400-blurred.dat</strong></p>
<blockquote>
<div><p>Blurred version of generic_reference_median_per_mirror_and_pupil_3400.dat.</p>
</div></blockquote>
<p><strong>generic_reference_median_per_mirror_and_pupil_33x0.dat</strong></p>
<blockquote>
<div><p>This generic reference was generated by taking all first luers of new and refurbished collectors that went into systems after 2017-01-01.
When including luers before 2017 more artifacts were observed, making the generic reference poor in quality.
It takes the median per farfield mirror and pupil combination. This is only availalbe in with_keys format.</p>
</div></blockquote>
<p><strong>generic_reference_median_per_mirror_and_pupil_33x0-blurred.dat</strong></p>
<blockquote>
<div><p>Blurred version of generic_reference_median_per_mirror_and_pupil_33x0.dat.</p>
</div></blockquote>
<p><strong>spiderweb.json</strong></p>
<blockquote>
<div><p>This is the so-called spiderweb definition. It consists of 60 regions of interest, build out of 5 concentric rings around the origin of a leur image.
In the tangential direction the rings are uniformly split in 12 sections.
The center of each ROI is at the full hour of the clock, so the edges go from 1:30 to 2:30 etc.</p>
</div></blockquote>
<p><strong>roi_definitions_from_field.json</strong></p>
<blockquote>
<div><p>This json contains ROI definitions (polygon) that approximate some known field issues.
The definitions are owned by PIT. The initial version is defined by RIOB.</p>
</div></blockquote>
<p><strong>spiderweb_kpi_mappping.json</strong></p>
<blockquote>
<div><p>This is the mapping of sets of ROIs to a predefined region. The regions are 5 rings and 8 quadrants.</p>
</div></blockquote>
</div>
<div class="section" id="module-pyeuv.Collector.Radon.radd">
<span id="radd"></span><h2>Radd<a class="headerlink" href="#module-pyeuv.Collector.Radon.radd" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.add_interpolated_image">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">add_interpolated_image</code><span class="sig-paren">(</span><em class="sig-param">luer_dict</em>, <em class="sig-param">dimension=256</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#add_interpolated_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.add_interpolated_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates an interpolated image (on a uniform grid) and adds it to the luer_dict</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_dict</strong> – dictionary containing luer data</p></li>
<li><p><strong>dimension</strong> – dimension of the image (default=256)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer dictionary including interpolated image data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.add_rois">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">add_rois</code><span class="sig-paren">(</span><em class="sig-param">luer_dict</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#add_rois"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.add_rois" title="Permalink to this definition">¶</a></dt>
<dd><p>Find rois in a boolean image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_dict</strong> – dictionary containing luer data</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer dictionary including interpolated image data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.add_segmentation">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">add_segmentation</code><span class="sig-paren">(</span><em class="sig-param">luer_dict</em>, <em class="sig-param">threshold</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#add_segmentation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.add_segmentation" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a column with boolean values to the data df indicating which data points are part of a ROI</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_dict</strong> – dictionary containing luer data</p></li>
<li><p><strong>threshold</strong> – threshold to be used for segmentation of luer image</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer dictionary containing the segmentation as well
The segmentation is a boolean column in data to</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.calc_growth">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">calc_growth</code><span class="sig-paren">(</span><em class="sig-param">parent_return</em>, <em class="sig-param">prev_rois</em>, <em class="sig-param">keys_in_roi</em>, <em class="sig-param">intensity_scaled</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#calc_growth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.calc_growth" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the growth of the roi
If totally new –&gt; growth is current size
If from 1 parent –&gt; compare it to the size of the parent
TODO: bit strange if it’s a split off of 1 parent
If from 2 parents –&gt; compare it to the sum of the 2 parents</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>intensity_scaled</strong> – intensities of all the pixels on a roi</p></li>
<li><p><strong>parent_return</strong> – parent of the roi</p></li>
<li><p><strong>prev_rois</strong> – rois in previous luer</p></li>
<li><p><strong>keys_in_roi</strong> – keys in roi</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the calculated growth</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.deal_with_zero_crossing">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">deal_with_zero_crossing</code><span class="sig-paren">(</span><em class="sig-param">data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#deal_with_zero_crossing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.deal_with_zero_crossing" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to solve the min max calculation of hour position
For example if the roi is from 11 to 1 hour then min = 1 and max = 11
Solved by converting all values left of 0 to minus values</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> – hour positions of dots within roi</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>updated hour positions of dots within roi</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.detect_rois">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">detect_rois</code><span class="sig-paren">(</span><em class="sig-param">luers_dict</em>, <em class="sig-param">key</em>, <em class="sig-param">max_threshold=70.0</em>, <em class="sig-param">nr_images_for_threshold=10</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#detect_rois"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.detect_rois" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect ROIs in current luer reflectivity image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luers_dict</strong> – the luers to use for determining the threshold</p></li>
<li><p><strong>key</strong> – the key of the luer to process</p></li>
<li><p><strong>max_threshold</strong> – maximum threshold to be used to avoid detection of noise (default=70.0)</p></li>
<li><p><strong>nr_images_for_threshold</strong> – number of images used to determine threshold (default=10)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary for this luer including the detected ROIs</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.detect_split_off_roi">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">detect_split_off_roi</code><span class="sig-paren">(</span><em class="sig-param">roi_nr_new</em>, <em class="sig-param">max_roi_nr_new</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#detect_split_off_roi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.detect_split_off_roi" title="Permalink to this definition">¶</a></dt>
<dd><p>If roi is splitted in 2 both rois should get a new number</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_roi_nr_new</strong> – the current max roi nr for the new rois</p></li>
<li><p><strong>roi_nr_new</strong> – the original roi nr new</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>updated roi_nr_new, max_roi_nr_new</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.extract_info_from_ts">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">extract_info_from_ts</code><span class="sig-paren">(</span><em class="sig-param">keys_in_rois_dict</em>, <em class="sig-param">images_all</em>, <em class="sig-param">n_clusters=2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#extract_info_from_ts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.extract_info_from_ts" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract info from ts
1. Put al pixel values inside rois into a df
2. Cluster rois into n_clusters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images_all</strong> – x, y, intensity_scaled of all previous images</p></li>
<li><p><strong>n_clusters</strong> – number of cluster to cluster the data in</p></li>
<li><p><strong>keys_in_rois_dict</strong> – keys are rois, values are coordinates</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>clusters</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.extract_pixel_value_history_per_roi">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">extract_pixel_value_history_per_roi</code><span class="sig-paren">(</span><em class="sig-param">pixels_in_rois_dict</em>, <em class="sig-param">images_all</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#extract_pixel_value_history_per_roi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.extract_pixel_value_history_per_roi" title="Permalink to this definition">¶</a></dt>
<dd><p>Get for all dots in rois the reflectivity of all history LUERs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pixels_in_rois_dict</strong> – keys are rois, values are coordinates</p></li>
<li><p><strong>images_all</strong> – dictionary with x,y as keys and intensity as value</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dataframe with the keys and reflectivities</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.get_maximum_roi_key">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">get_maximum_roi_key</code><span class="sig-paren">(</span><em class="sig-param">keys_prev</em>, <em class="sig-param">luers_dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#get_maximum_roi_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.get_maximum_roi_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the maximum roi key used in the previous luers. Returns -1 in case no luer was detected yet.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keys_prev</strong> – list of all the luer keys of previous luers</p></li>
<li><p><strong>luers_dict</strong> – dictionary with all available luers</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>maximum roi key used in the previous luers.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.get_threshold">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">get_threshold</code><span class="sig-paren">(</span><em class="sig-param">luers_dict</em>, <em class="sig-param">key</em>, <em class="sig-param">max_threshold=70.0</em>, <em class="sig-param">nr_images_for_threshold=10</em>, <em class="sig-param">reflectivity_threshold=10.0</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#get_threshold"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.get_threshold" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine threshold for roi detection</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luers_dict</strong> – the luers to use for determining the threshold</p></li>
<li><p><strong>key</strong> – the key of the luer to process</p></li>
<li><p><strong>max_threshold</strong> – maximum threshold to be used to avoid detection of noise (default=70.0)</p></li>
<li><p><strong>nr_images_for_threshold</strong> – number of images used to determine threshold (default=10)</p></li>
<li><p><strong>reflectivity_threshold</strong> – lower limit of reflectivity to include in threshold calculation</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>roi detection threshold</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.link_to_existing_rois">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">link_to_existing_rois</code><span class="sig-paren">(</span><em class="sig-param">luers_dict</em>, <em class="sig-param">key</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#link_to_existing_rois"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.link_to_existing_rois" title="Permalink to this definition">¶</a></dt>
<dd><p>Links the current ROI to a ROI in a previous RADON</p>
<p>We use the following names:</p>
<ul class="simple">
<li><p>parents: the indices of the ROIs in the previous Luer that partially overlap with the current ROI.</p></li>
<li><p>ancestors: the list of all parents, recursively from all previous luers</p></li>
<li><p>main ancestor: the most important ancestor, which is the main ancestor of the largest parent of the previous luer.
This is useful to keep track over an ROI over time. This is the stable number you can refer to, and can for
instance be used for colors in drawing the ROIs.</p></li>
</ul>
<p>4 options:</p>
<ol class="arabic simple">
<li><p>Totally new –&gt; parent_return = [], roi_nr = i</p></li>
<li><p>Continuation of a previous roi –&gt; parent_return = matched prev roi nr,
roi_nr = matched prev roi nr</p></li>
<li><p>Combination of 2 previous rois –&gt; parent_return = [prev roi 1, prev roi 2]
roi_nr = give it a new number</p></li>
<li><p>Split of previous roi: multiple rois have the same parent
roi_nr = give it a new number</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luers_dict</strong> – dictionary with all luers</p></li>
<li><p><strong>key</strong> – key of current luer</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default:False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>current luer dictionary, now containing parent and ancestor information</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.load_processed_radd_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">load_processed_radd_data</code><span class="sig-paren">(</span><em class="sig-param">output_folder</em>, <em class="sig-param">reprocess_collector</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#load_processed_radd_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.load_processed_radd_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads processed radd data: image data, rois per luer image, and ros per roi id</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_folder</strong> – Folder to store RADD output</p></li>
<li><p><strong>reprocess_collector</strong> – switch to return data or empty dicts</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tuple of dictionaries of image data, rois per luer image, and ros per roi id</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.load_radd_metrics_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">load_radd_metrics_data</code><span class="sig-paren">(</span><em class="sig-param">output_folder</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#load_radd_metrics_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.load_radd_metrics_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads RADD metrics data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output_folder</strong> – Folder to store RADD output</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with metrics data per roi, per image</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.prepare_plot_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">prepare_plot_data</code><span class="sig-paren">(</span><em class="sig-param">dict_sel_c</em>, <em class="sig-param">x_axis</em>, <em class="sig-param">y_axis</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#prepare_plot_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.prepare_plot_data" title="Permalink to this definition">¶</a></dt>
<dd><p>To check: obsolete?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_sel_c</strong> – </p></li>
<li><p><strong>x_axis</strong> – </p></li>
<li><p><strong>y_axis</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.prepare_selected_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">prepare_selected_data</code><span class="sig-paren">(</span><em class="sig-param">roi_props_all_roi_nr</em>, <em class="sig-param">luer_file_properties</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#prepare_selected_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.prepare_selected_data" title="Permalink to this definition">¶</a></dt>
<dd><p>To check: Obsolete?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>roi_props_all_roi_nr</strong> – dict with roi nr as key and dataframe with metrics per luer as value</p></li>
<li><p><strong>luer_file_properties</strong> – dataframe with all info about the luers</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.save_luer_plots_with_rois">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">save_luer_plots_with_rois</code><span class="sig-paren">(</span><em class="sig-param">images_to_save</em>, <em class="sig-param">luer_images</em>, <em class="sig-param">output_folder</em>, <em class="sig-param">roi_props_all_image_nr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#save_luer_plots_with_rois"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.save_luer_plots_with_rois" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves luer plots including detected ROIs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images_to_save</strong> – luer images to be saved</p></li>
<li><p><strong>luer_images</strong> – all luer images</p></li>
<li><p><strong>output_folder</strong> – Folder to store RADD output</p></li>
<li><p><strong>roi_props_all_image_nr</strong> – dictionary with information of detected ROIs</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.store_processed_radd_data">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">store_processed_radd_data</code><span class="sig-paren">(</span><em class="sig-param">output_folder</em>, <em class="sig-param">image_data_all</em>, <em class="sig-param">roi_props_by_luer_key</em>, <em class="sig-param">roi_props_by_roi_key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#store_processed_radd_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.store_processed_radd_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores the RADD output</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_folder</strong> – Folder to story RADD output</p></li>
<li><p><strong>image_data_all</strong> – dictionary with luer images</p></li>
<li><p><strong>roi_props_by_luer_key</strong> – dictionary with ROI info, data per luer</p></li>
<li><p><strong>roi_props_by_roi_key</strong> – dictionary with ROI info, data per roi</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.store_roi_metrics">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">store_roi_metrics</code><span class="sig-paren">(</span><em class="sig-param">output_folder</em>, <em class="sig-param">rois_roi_as_key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#store_roi_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.store_roi_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores RADD roi metrics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_folder</strong> – Folder to story RADD output</p></li>
<li><p><strong>rois_roi_as_key</strong> – dictionary of rois, ordered by roi id</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.to_original_keys">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">to_original_keys</code><span class="sig-paren">(</span><em class="sig-param">luer_dict</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#to_original_keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.to_original_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts the roi coordinates back to original image coordinates
removes the interpolated pixels</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>luer_dict</strong> – dictionary containing luer data</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>luer dictionary including interpolated image data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Radon.radd.update_rois_with_roi_as_key">
<code class="sig-prename descclassname">pyeuv.Collector.Radon.radd.</code><code class="sig-name descname">update_rois_with_roi_as_key</code><span class="sig-paren">(</span><em class="sig-param">rois_roi_as_key</em>, <em class="sig-param">luer_dict</em>, <em class="sig-param">luer_key</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Radon/radd.html#update_rois_with_roi_as_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Radon.radd.update_rois_with_roi_as_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the rois (with roi as key) dictionary with detected rois</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rois_roi_as_key</strong> – dictionary with rois as key</p></li>
<li><p><strong>luer_dict</strong> – dictionary with luer image data</p></li>
<li><p><strong>luer_key</strong> – key of the luer image</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>updated rois_roi_as_key</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-pyeuv.Collector.Sliedt.illuminator_degradation">
<span id="illuminator"></span><h2>Illuminator<a class="headerlink" href="#module-pyeuv.Collector.Sliedt.illuminator_degradation" title="Permalink to this headline">¶</a></h2>
<p>InfluxURLClient.py
Originally created by JBKH
Modified by RWKL to be usable as library by different teams
Date: 2018-07-21</p>
<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.add_mode_names">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">add_mode_names</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#add_mode_names"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.add_mode_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Identify the known illumination modes in the dataframe. Makes use of the
mapping contained in the mode_map table defined above.
Return the mode name and the es_correction factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calc_PFM_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calc_PFM_transmission</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">PFM_states</em>, <em class="sig-param">model=&lt;pyeuv.Collector.Sliedt.illuminator_degradation.degradation_model object&gt;</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calc_PFM_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calc_PFM_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate the transmission of the Pupil Facets (N_FFM * N_PFM) as a function
of time using the cumulative gigapulse count per mode and the map of Pupil
Facet mirrors per mode.</p>
<p>This consists of two consecutive steps:
1) Obtain the cumulative gigapulse count per Pupil Facet.
2) Apply the Pupil Facet transmission model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>PFM_states</strong> – map of pupil faced mirrors per mode</p></li>
<li><p><strong>model</strong> – degradation model (default: exponential decay using default parameters)</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>transmission per pupil facet and degradation rate per pupil facet</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calc_degradation_rate">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calc_degradation_rate</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">pulse_count</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calc_degradation_rate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calc_degradation_rate" title="Permalink to this definition">¶</a></dt>
<dd><p>The Pupil Facet transmission derivative to gigapulse, ie. degradation rate.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – the model parameters to be applied</p></li>
<li><p><strong>pulse_count</strong> – Pulse count seen by this pupil facet in Gp</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the derivative of the relative transmission of a pupil facet after an amount of Gps</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calc_illuminator_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calc_illuminator_transmission</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calc_illuminator_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calc_illuminator_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the transmission of an illuminator as function of time given
the loaded dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calc_mode_degradation">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calc_mode_degradation</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">mode</em>, <em class="sig-param">PFM_states</em>, <em class="sig-param">PFM_degradation_rate</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calc_mode_degradation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calc_mode_degradation" title="Permalink to this definition">¶</a></dt>
<dd><p>For a specific mode, calculate the current degradation rate. This is
normalized to t=0, ie. start of illuminator life.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>mode</strong> – illumination mode</p></li>
<li><p><strong>PFM_states</strong> – map of pupil faced mirrors per mode</p></li>
<li><p><strong>PFM_degradation_rate</strong> – map of degradation rate per pupil faced mirror</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>degradation per mode as function of pulsecount of the machine</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calc_mode_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calc_mode_transmission</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">PFM_states</em>, <em class="sig-param">PFM_transmission</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calc_mode_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calc_mode_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>With the PFM transmission, calculate the mode transmission as a function
of time</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>PFM_states</strong> – map of pupil faced mirrors per mode</p></li>
<li><p><strong>PFM_transmission</strong> – transmission per pupil facet</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>transmission per illumination mode as function of pulsecount of the machine</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calc_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calc_transmission</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">pulse_count</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calc_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calc_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Empirical estimate of transmission of Pupil Facet as function of exposed
gigapulses. Assumes exponential decay.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – the model parameters to be applied</p></li>
<li><p><strong>pulse_count</strong> – Pulsecount seen by this pupil facet in Gp</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the relative transmission of a pupil facet after an amount of Gps</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.calculate_pf_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">calculate_pf_transmission</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#calculate_pf_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.calculate_pf_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the pupil facet transmission.
The illuminator degradation library is used for this calculation.
It is based on the model assuming exponential decay proposed by JHAG</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing input data to calculate transmission per illumination mode</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing transmission per illumination mode</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.degradation_model">
<em class="property">class </em><code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">degradation_model</code><span class="sig-paren">(</span><em class="sig-param">rate=0.0325</em>, <em class="sig-param">limit=0.15</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#degradation_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.degradation_model" title="Permalink to this definition">¶</a></dt>
<dd><p>The model of exponential decay is described by the initial degradation rate
and the maximum amount of degradation.
By default it uses the a rate 0f 0.0325%/Gp and the total degradation is
limited by 15%. The initialization allows the user to modify these two
parameters of the model.</p>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.get_PFM_map">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">get_PFM_map</code><span class="sig-paren">(</span><em class="sig-param">mode</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#get_PFM_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.get_PFM_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the name of the Pupil Facet map given the name of a mode.
These are not necessarily the same, hence this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mode</strong> – name of the mode</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.get_mode_details">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">get_mode_details</code><span class="sig-paren">(</span><em class="sig-param">mode</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#get_mode_details"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.get_mode_details" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the values in the mode_map dict given the name of a mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mode</strong> – name of the mode</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.get_pf_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">get_pf_transmission</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#get_pf_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.get_pf_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the pupil facet transmission.
The illuminator degradation library is used for this calculation.
It is based on the model assuming exponential decay proposed by JHAG</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>source_id</strong> – the source_id for which the pupil facet degradation has to be estimated</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing transmission per illumination mode</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.get_pf_transmission_data">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">get_pf_transmission_data</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#get_pf_transmission_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.get_pf_transmission_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the pupil facet transmission data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influx</p></li>
<li><p><strong>source_id</strong> – the source_id for which the pupil facet degradation has to be estimated</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe containing input data to calculate transmission per illumination mode</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.get_signal">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">get_signal</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_nr</em>, <em class="sig-param">input_signals</em>, <em class="sig-param">from_time</em>, <em class="sig-param">to_time</em>, <em class="sig-param">selection=''</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#get_signal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.get_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to load the influx signals and change column names to
signal aliases.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – influx client</p></li>
<li><p><strong>source_nr</strong> – source number</p></li>
<li><p><strong>input_signals</strong> – influx signals to be downloaded from influx</p></li>
<li><p><strong>from_time</strong> – start of window in time domain</p></li>
<li><p><strong>to_time</strong> – end of window in time domain</p></li>
<li><p><strong>selection</strong> – optional paramater to append grouping of data</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>pandas dataframe containing requested influx data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.load_PFM_states">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">load_PFM_states</code><span class="sig-paren">(</span><em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#load_PFM_states"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.load_PFM_states" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the FF-to-PF mapping per illumination mode from the mirror_states.csv file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> – to switch internal debug info</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.load_df">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">load_df</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">source_id</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#load_df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.load_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the signals necessary to estimate the Pupil Facet degradation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – influx client</p></li>
<li><p><strong>source_id</strong> – source id</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with all required data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.plot_mode_transmission">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">plot_mode_transmission</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">mode_transmission</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#plot_mode_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.plot_mode_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Extra function to plot the mode transmission, ie. transmission of the known
illumination modes normalized to 100% at beginning of illuminator life.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>mode_transmission</strong> – dataframe containing transmission per mode as function of pulsecount of the system</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.plot_mode_usage">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">plot_mode_usage</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">mode_transmission</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#plot_mode_usage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.plot_mode_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Extra function to plot the mode usage (ie. cumulative gigapulse count per mode)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>mode_transmission</strong> – dataframe containing transmission per mode as function of pulsecount of the system</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.prepare_df">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">prepare_df</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#prepare_df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.prepare_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare the dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – pandas dataframe to be prepared</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with prepared data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Sliedt.illuminator_degradation.print_degradation_rates">
<code class="sig-prename descclassname">pyeuv.Collector.Sliedt.illuminator_degradation.</code><code class="sig-name descname">print_degradation_rates</code><span class="sig-paren">(</span><em class="sig-param">df</em>, <em class="sig-param">mode_transmission</em>, <em class="sig-param">PFM_degradation_rate</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Sliedt/illuminator_degradation.html#print_degradation_rates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Sliedt.illuminator_degradation.print_degradation_rates" title="Permalink to this definition">¶</a></dt>
<dd><p>Extra function to print the current degradation rates of each known mode,
normalized to 100% at beginning of illuminator life.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing illumination mode data</p></li>
<li><p><strong>mode_transmission</strong> – dataframe containing transmission per mode as function of pulsecount of the system</p></li>
<li><p><strong>PFM_degradation_rate</strong> – dataframe containing degradation rate per mode as function of pulsecount of the system</p></li>
<li><p><strong>verbose</strong> – to switch internal debug info</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-pyeuv.Collector.Sliedt.illumination_mode"></span></div>
<div class="section" id="module-pyeuv.Collector.Shared.directory_structure">
<span id="shared"></span><h2>Shared<a class="headerlink" href="#module-pyeuv.Collector.Shared.directory_structure" title="Permalink to this headline">¶</a></h2>
<p>Created on Wed Feb  6 13:34:31 2019</p>
<p>&#64;author: rwiegger</p>
<p>This contains a set of functions to be able to browse through the collector performance reports drive.</p>
<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.convert_display_name_to_simplified_name">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">convert_display_name_to_simplified_name</code><span class="sig-paren">(</span><em class="sig-param">display_name</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#convert_display_name_to_simplified_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.convert_display_name_to_simplified_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the simplified name from a machine’s display name, using some regular expressions.
These names are typically used oin the directory names of machines, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>display_name</strong> – the display name of a machine</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>simplified machine name</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.create_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">create_directory</code><span class="sig-paren">(</span><em class="sig-param">directory_name</em>, <em class="sig-param">force=False</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#create_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.create_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates, in case it did not exist, the directory given by directory_name.
In case the directory name already exists as a file, and force is enabled,
it removes the file and creates the directory</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>directory_name</strong> – Full path of directory name to be made</p></li>
<li><p><strong>force</strong> – Enforces to create the directory, even if it currently exists as file instead of directory
(default: False)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.create_directory_structure">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">create_directory_structure</code><span class="sig-paren">(</span><em class="sig-param">client</em>, <em class="sig-param">root</em>, <em class="sig-param">machine_list</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#create_directory_structure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.create_directory_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the directory structure as used on the Collector Performance Reports share drive</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – connection to influxDB</p></li>
<li><p><strong>root</strong> – root path of the directory structure</p></li>
<li><p><strong>machine_list</strong> – dataframee of machines</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)x</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_annotations_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_annotations_directory</code><span class="sig-paren">(</span><em class="sig-param">collector_directory</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_annotations_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_annotations_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the annotations directory, a sub directory of the collector directory</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collector_directory</strong> – the collector directory, in which an annotations_directory is expected to exist()</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>path of annotations directory</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_collector_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_collector_directory</code><span class="sig-paren">(</span><em class="sig-param">conf</em>, <em class="sig-param">base_dir</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_collector_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_collector_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the directory within the collector performance directory structure that
belongs to the specified collector</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conf</strong> – object containing properties of a machine</p></li>
<li><p><strong>base_dir</strong> – root directory in which data for all machines is stored</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the directory for the specified machine</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_directories_from_substring">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_directories_from_substring</code><span class="sig-paren">(</span><em class="sig-param">directory</em>, <em class="sig-param">substring</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_directories_from_substring"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_directories_from_substring" title="Permalink to this definition">¶</a></dt>
<dd><p>this function looks for directory names of the subdirectories within ‘directory’,
which contain ‘substring’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>directory</strong> – directory in which one tries to find directory names</p></li>
<li><p><strong>substring</strong> – the substring to look for</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of directory names</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_luer_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_luer_directory</code><span class="sig-paren">(</span><em class="sig-param">collector_directory=None</em>, <em class="sig-param">client=None</em>, <em class="sig-param">base_dir=None</em>, <em class="sig-param">machine_id=None</em>, <em class="sig-param">collector_name=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_luer_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_luer_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the luer directory, a sub directory of the collector directory
If the collector directory is provided, it uses this to determine the luer directory.
Otherwise, it will be determined based on the other parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collector_directory</strong> – the collector directory (default=None)</p></li>
<li><p><strong>client</strong> – connection to influx (default=None)</p></li>
<li><p><strong>base_dir</strong> – base directory of the directory structure of all machines and collectors (default=None)</p></li>
<li><p><strong>machine_id</strong> – machine id, e.g. ‘m1234’ (default=None)</p></li>
<li><p><strong>collector_name</strong> – collector name, used to select collector properties from influx (default=None)</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>path of luer directory</p>
</dd>
<dt class="field-odd">Raise</dt>
<dd class="field-odd"><p>Exception in case the required input parameters are not provided</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_machine_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_machine_directory</code><span class="sig-paren">(</span><em class="sig-param">conf</em>, <em class="sig-param">base_dir</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_machine_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_machine_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the directory within the collector performance directory structure that
belongs tothe specified machine</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conf</strong> – object containing properties of a machine</p></li>
<li><p><strong>base_dir</strong> – root directory in which data for all machines is stored</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the directory for the specified machine</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_matching_machine_directories">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_matching_machine_directories</code><span class="sig-paren">(</span><em class="sig-param">conf</em>, <em class="sig-param">base_dir</em>, <em class="sig-param">verbose</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_matching_machine_directories"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_matching_machine_directories" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds all matching machine directories. It checks for the substring containing the vessel_id and source_id.
In case multiple directories are found, it will also return multiple. This could happen in case:</p>
<blockquote>
<div><ul class="simple">
<li><p>a pilot system goes to the customer. The vessel_id and source_id do not change, however,
the machine identifier changes.</p></li>
<li><p>For some reason, a directory is duplicated (suspecting some user doing this manually,
at the risk of breaking tooling</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conf</strong> – the machine configuration, based on the machine list</p></li>
<li><p><strong>base_dir</strong> – The (CPR) base directory</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of matching directories</p>
</dd>
<dt class="field-odd">Raise</dt>
<dd class="field-odd"><p>Exception from get_directories_from_substring</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.get_share_base_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">get_share_base_directory</code><span class="sig-paren">(</span><em class="sig-param">local=False</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#get_share_base_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.get_share_base_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the collector performance base directory</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> – switches debug mode (default=False)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>path of the collector performance base directory</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.is_collector_directory">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">is_collector_directory</code><span class="sig-paren">(</span><em class="sig-param">directory</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#is_collector_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.is_collector_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks for several conditions to validate a string is a collector directory name
The format of a valid collector directory is ‘#X_SDMSCxxx_Y’, where X and xxx are numeric</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>directory</strong> – the string to be checked</p></li>
<li><p><strong>verbose</strong> – switches debug mode (default=False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True in case the string is formatted correctly, otherwise it return False</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyeuv.Collector.Shared.directory_structure.update_directory_structure">
<code class="sig-prename descclassname">pyeuv.Collector.Shared.directory_structure.</code><code class="sig-name descname">update_directory_structure</code><span class="sig-paren">(</span><em class="sig-param">root</em>, <em class="sig-param">machine_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyeuv/Collector/Shared/directory_structure.html#update_directory_structure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyeuv.Collector.Shared.directory_structure.update_directory_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the machine directory name for old machines by adding the tag ‘_old’ to the directory name</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root</strong> – root path of the directory structure</p></li>
<li><p><strong>machine_list</strong> – dataframee of machines</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Do_It.html" class="btn btn-neutral float-right" title="Do_It" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Parsers.html" class="btn btn-neutral float-left" title="Parsers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, ASML HOLDING N.V. (INCLUDING AFFILIATES). ALL RIGHTS RESERVED..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>